!function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=5)}([function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"EPSILON",(function(){return d})),e.d(r,"ARRAY_TYPE",(function(){return m})),e.d(r,"RANDOM",(function(){return p})),e.d(r,"setMatrixArrayType",(function(){return v})),e.d(r,"toRadian",(function(){return M})),e.d(r,"equals",(function(){return b}));var i={};e.r(i),e.d(i,"create",(function(){return x})),e.d(i,"clone",(function(){return w})),e.d(i,"copy",(function(){return y})),e.d(i,"identity",(function(){return T})),e.d(i,"fromValues",(function(){return S})),e.d(i,"set",(function(){return V})),e.d(i,"transpose",(function(){return A})),e.d(i,"invert",(function(){return L})),e.d(i,"adjoint",(function(){return D})),e.d(i,"determinant",(function(){return E})),e.d(i,"multiply",(function(){return P})),e.d(i,"rotate",(function(){return _})),e.d(i,"scale",(function(){return N})),e.d(i,"fromRotation",(function(){return R})),e.d(i,"fromScaling",(function(){return I})),e.d(i,"str",(function(){return j})),e.d(i,"frob",(function(){return F})),e.d(i,"LDU",(function(){return $})),e.d(i,"add",(function(){return k})),e.d(i,"subtract",(function(){return q})),e.d(i,"exactEquals",(function(){return B})),e.d(i,"equals",(function(){return O})),e.d(i,"multiplyScalar",(function(){return C})),e.d(i,"multiplyScalarAndAdd",(function(){return U})),e.d(i,"mul",(function(){return z})),e.d(i,"sub",(function(){return G}));var a={};e.r(a),e.d(a,"create",(function(){return H})),e.d(a,"clone",(function(){return X})),e.d(a,"copy",(function(){return Y})),e.d(a,"identity",(function(){return W})),e.d(a,"fromValues",(function(){return Q})),e.d(a,"set",(function(){return J})),e.d(a,"invert",(function(){return Z})),e.d(a,"determinant",(function(){return K})),e.d(a,"multiply",(function(){return tt})),e.d(a,"rotate",(function(){return nt})),e.d(a,"scale",(function(){return et})),e.d(a,"translate",(function(){return rt})),e.d(a,"fromRotation",(function(){return it})),e.d(a,"fromScaling",(function(){return at})),e.d(a,"fromTranslation",(function(){return ot})),e.d(a,"str",(function(){return st})),e.d(a,"frob",(function(){return ut})),e.d(a,"add",(function(){return ct})),e.d(a,"subtract",(function(){return ht})),e.d(a,"multiplyScalar",(function(){return ft})),e.d(a,"multiplyScalarAndAdd",(function(){return lt})),e.d(a,"exactEquals",(function(){return dt})),e.d(a,"equals",(function(){return mt})),e.d(a,"mul",(function(){return pt})),e.d(a,"sub",(function(){return vt}));var o={};e.r(o),e.d(o,"create",(function(){return gt})),e.d(o,"fromMat4",(function(){return Mt})),e.d(o,"clone",(function(){return bt})),e.d(o,"copy",(function(){return xt})),e.d(o,"fromValues",(function(){return wt})),e.d(o,"set",(function(){return yt})),e.d(o,"identity",(function(){return Tt})),e.d(o,"transpose",(function(){return St})),e.d(o,"invert",(function(){return Vt})),e.d(o,"adjoint",(function(){return At})),e.d(o,"determinant",(function(){return Lt})),e.d(o,"multiply",(function(){return Dt})),e.d(o,"translate",(function(){return Et})),e.d(o,"rotate",(function(){return Pt})),e.d(o,"scale",(function(){return _t})),e.d(o,"fromTranslation",(function(){return Nt})),e.d(o,"fromRotation",(function(){return Rt})),e.d(o,"fromScaling",(function(){return It})),e.d(o,"fromMat2d",(function(){return jt})),e.d(o,"fromQuat",(function(){return Ft})),e.d(o,"normalFromMat4",(function(){return $t})),e.d(o,"projection",(function(){return kt})),e.d(o,"str",(function(){return qt})),e.d(o,"frob",(function(){return Bt})),e.d(o,"add",(function(){return Ot})),e.d(o,"subtract",(function(){return Ct})),e.d(o,"multiplyScalar",(function(){return Ut})),e.d(o,"multiplyScalarAndAdd",(function(){return zt})),e.d(o,"exactEquals",(function(){return Gt})),e.d(o,"equals",(function(){return Ht})),e.d(o,"mul",(function(){return Xt})),e.d(o,"sub",(function(){return Yt}));var s={};e.r(s),e.d(s,"create",(function(){return Wt})),e.d(s,"clone",(function(){return Qt})),e.d(s,"copy",(function(){return Jt})),e.d(s,"fromValues",(function(){return Zt})),e.d(s,"set",(function(){return Kt})),e.d(s,"identity",(function(){return tn})),e.d(s,"transpose",(function(){return nn})),e.d(s,"invert",(function(){return en})),e.d(s,"adjoint",(function(){return rn})),e.d(s,"determinant",(function(){return an})),e.d(s,"multiply",(function(){return on})),e.d(s,"translate",(function(){return sn})),e.d(s,"scale",(function(){return un})),e.d(s,"rotate",(function(){return cn})),e.d(s,"rotateX",(function(){return hn})),e.d(s,"rotateY",(function(){return fn})),e.d(s,"rotateZ",(function(){return ln})),e.d(s,"fromTranslation",(function(){return dn})),e.d(s,"fromScaling",(function(){return mn})),e.d(s,"fromRotation",(function(){return pn})),e.d(s,"fromXRotation",(function(){return vn})),e.d(s,"fromYRotation",(function(){return gn})),e.d(s,"fromZRotation",(function(){return Mn})),e.d(s,"fromRotationTranslation",(function(){return bn})),e.d(s,"fromQuat2",(function(){return xn})),e.d(s,"getTranslation",(function(){return wn})),e.d(s,"getScaling",(function(){return yn})),e.d(s,"getRotation",(function(){return Tn})),e.d(s,"fromRotationTranslationScale",(function(){return Sn})),e.d(s,"fromRotationTranslationScaleOrigin",(function(){return Vn})),e.d(s,"fromQuat",(function(){return An})),e.d(s,"frustum",(function(){return Ln})),e.d(s,"perspective",(function(){return Dn})),e.d(s,"perspectiveFromFieldOfView",(function(){return En})),e.d(s,"ortho",(function(){return Pn})),e.d(s,"lookAt",(function(){return _n})),e.d(s,"targetTo",(function(){return Nn})),e.d(s,"str",(function(){return Rn})),e.d(s,"frob",(function(){return In})),e.d(s,"add",(function(){return jn})),e.d(s,"subtract",(function(){return Fn})),e.d(s,"multiplyScalar",(function(){return $n})),e.d(s,"multiplyScalarAndAdd",(function(){return kn})),e.d(s,"exactEquals",(function(){return qn})),e.d(s,"equals",(function(){return Bn})),e.d(s,"mul",(function(){return On})),e.d(s,"sub",(function(){return Cn}));var u={};e.r(u),e.d(u,"create",(function(){return Un})),e.d(u,"clone",(function(){return zn})),e.d(u,"length",(function(){return Gn})),e.d(u,"fromValues",(function(){return Hn})),e.d(u,"copy",(function(){return Xn})),e.d(u,"set",(function(){return Yn})),e.d(u,"add",(function(){return Wn})),e.d(u,"subtract",(function(){return Qn})),e.d(u,"multiply",(function(){return Jn})),e.d(u,"divide",(function(){return Zn})),e.d(u,"ceil",(function(){return Kn})),e.d(u,"floor",(function(){return te})),e.d(u,"min",(function(){return ne})),e.d(u,"max",(function(){return ee})),e.d(u,"round",(function(){return re})),e.d(u,"scale",(function(){return ie})),e.d(u,"scaleAndAdd",(function(){return ae})),e.d(u,"distance",(function(){return oe})),e.d(u,"squaredDistance",(function(){return se})),e.d(u,"squaredLength",(function(){return ue})),e.d(u,"negate",(function(){return ce})),e.d(u,"inverse",(function(){return he})),e.d(u,"normalize",(function(){return fe})),e.d(u,"dot",(function(){return le})),e.d(u,"cross",(function(){return de})),e.d(u,"lerp",(function(){return me})),e.d(u,"hermite",(function(){return pe})),e.d(u,"bezier",(function(){return ve})),e.d(u,"random",(function(){return ge})),e.d(u,"transformMat4",(function(){return Me})),e.d(u,"transformMat3",(function(){return be})),e.d(u,"transformQuat",(function(){return xe})),e.d(u,"rotateX",(function(){return we})),e.d(u,"rotateY",(function(){return ye})),e.d(u,"rotateZ",(function(){return Te})),e.d(u,"angle",(function(){return Se})),e.d(u,"zero",(function(){return Ve})),e.d(u,"str",(function(){return Ae})),e.d(u,"exactEquals",(function(){return Le})),e.d(u,"equals",(function(){return De})),e.d(u,"sub",(function(){return Pe})),e.d(u,"mul",(function(){return _e})),e.d(u,"div",(function(){return Ne})),e.d(u,"dist",(function(){return Re})),e.d(u,"sqrDist",(function(){return Ie})),e.d(u,"len",(function(){return je})),e.d(u,"sqrLen",(function(){return Fe})),e.d(u,"forEach",(function(){return $e}));var c={};e.r(c),e.d(c,"create",(function(){return ke})),e.d(c,"clone",(function(){return qe})),e.d(c,"fromValues",(function(){return Be})),e.d(c,"copy",(function(){return Oe})),e.d(c,"set",(function(){return Ce})),e.d(c,"add",(function(){return Ue})),e.d(c,"subtract",(function(){return ze})),e.d(c,"multiply",(function(){return Ge})),e.d(c,"divide",(function(){return He})),e.d(c,"ceil",(function(){return Xe})),e.d(c,"floor",(function(){return Ye})),e.d(c,"min",(function(){return We})),e.d(c,"max",(function(){return Qe})),e.d(c,"round",(function(){return Je})),e.d(c,"scale",(function(){return Ze})),e.d(c,"scaleAndAdd",(function(){return Ke})),e.d(c,"distance",(function(){return tr})),e.d(c,"squaredDistance",(function(){return nr})),e.d(c,"length",(function(){return er})),e.d(c,"squaredLength",(function(){return rr})),e.d(c,"negate",(function(){return ir})),e.d(c,"inverse",(function(){return ar})),e.d(c,"normalize",(function(){return or})),e.d(c,"dot",(function(){return sr})),e.d(c,"cross",(function(){return ur})),e.d(c,"lerp",(function(){return cr})),e.d(c,"random",(function(){return hr})),e.d(c,"transformMat4",(function(){return fr})),e.d(c,"transformQuat",(function(){return lr})),e.d(c,"zero",(function(){return dr})),e.d(c,"str",(function(){return mr})),e.d(c,"exactEquals",(function(){return pr})),e.d(c,"equals",(function(){return vr})),e.d(c,"sub",(function(){return gr})),e.d(c,"mul",(function(){return Mr})),e.d(c,"div",(function(){return br})),e.d(c,"dist",(function(){return xr})),e.d(c,"sqrDist",(function(){return wr})),e.d(c,"len",(function(){return yr})),e.d(c,"sqrLen",(function(){return Tr})),e.d(c,"forEach",(function(){return Sr}));var h={};e.r(h),e.d(h,"create",(function(){return Vr})),e.d(h,"identity",(function(){return Ar})),e.d(h,"setAxisAngle",(function(){return Lr})),e.d(h,"getAxisAngle",(function(){return Dr})),e.d(h,"getAngle",(function(){return Er})),e.d(h,"multiply",(function(){return Pr})),e.d(h,"rotateX",(function(){return _r})),e.d(h,"rotateY",(function(){return Nr})),e.d(h,"rotateZ",(function(){return Rr})),e.d(h,"calculateW",(function(){return Ir})),e.d(h,"exp",(function(){return jr})),e.d(h,"ln",(function(){return Fr})),e.d(h,"pow",(function(){return $r})),e.d(h,"slerp",(function(){return kr})),e.d(h,"random",(function(){return qr})),e.d(h,"invert",(function(){return Br})),e.d(h,"conjugate",(function(){return Or})),e.d(h,"fromMat3",(function(){return Cr})),e.d(h,"fromEuler",(function(){return Ur})),e.d(h,"str",(function(){return zr})),e.d(h,"clone",(function(){return Jr})),e.d(h,"fromValues",(function(){return Zr})),e.d(h,"copy",(function(){return Kr})),e.d(h,"set",(function(){return ti})),e.d(h,"add",(function(){return ni})),e.d(h,"mul",(function(){return ei})),e.d(h,"scale",(function(){return ri})),e.d(h,"dot",(function(){return ii})),e.d(h,"lerp",(function(){return ai})),e.d(h,"length",(function(){return oi})),e.d(h,"len",(function(){return si})),e.d(h,"squaredLength",(function(){return ui})),e.d(h,"sqrLen",(function(){return ci})),e.d(h,"normalize",(function(){return hi})),e.d(h,"exactEquals",(function(){return fi})),e.d(h,"equals",(function(){return li})),e.d(h,"rotationTo",(function(){return di})),e.d(h,"sqlerp",(function(){return mi})),e.d(h,"setAxes",(function(){return pi}));var f={};e.r(f),e.d(f,"create",(function(){return vi})),e.d(f,"clone",(function(){return gi})),e.d(f,"fromValues",(function(){return Mi})),e.d(f,"fromRotationTranslationValues",(function(){return bi})),e.d(f,"fromRotationTranslation",(function(){return xi})),e.d(f,"fromTranslation",(function(){return wi})),e.d(f,"fromRotation",(function(){return yi})),e.d(f,"fromMat4",(function(){return Ti})),e.d(f,"copy",(function(){return Si})),e.d(f,"identity",(function(){return Vi})),e.d(f,"set",(function(){return Ai})),e.d(f,"getReal",(function(){return Li})),e.d(f,"getDual",(function(){return Di})),e.d(f,"setReal",(function(){return Ei})),e.d(f,"setDual",(function(){return Pi})),e.d(f,"getTranslation",(function(){return _i})),e.d(f,"translate",(function(){return Ni})),e.d(f,"rotateX",(function(){return Ri})),e.d(f,"rotateY",(function(){return Ii})),e.d(f,"rotateZ",(function(){return ji})),e.d(f,"rotateByQuatAppend",(function(){return Fi})),e.d(f,"rotateByQuatPrepend",(function(){return $i})),e.d(f,"rotateAroundAxis",(function(){return ki})),e.d(f,"add",(function(){return qi})),e.d(f,"multiply",(function(){return Bi})),e.d(f,"mul",(function(){return Oi})),e.d(f,"scale",(function(){return Ci})),e.d(f,"dot",(function(){return Ui})),e.d(f,"lerp",(function(){return zi})),e.d(f,"invert",(function(){return Gi})),e.d(f,"conjugate",(function(){return Hi})),e.d(f,"length",(function(){return Xi})),e.d(f,"len",(function(){return Yi})),e.d(f,"squaredLength",(function(){return Wi})),e.d(f,"sqrLen",(function(){return Qi})),e.d(f,"normalize",(function(){return Ji})),e.d(f,"str",(function(){return Zi})),e.d(f,"exactEquals",(function(){return Ki})),e.d(f,"equals",(function(){return ta}));var l={};e.r(l),e.d(l,"create",(function(){return na})),e.d(l,"clone",(function(){return ea})),e.d(l,"fromValues",(function(){return ra})),e.d(l,"copy",(function(){return ia})),e.d(l,"set",(function(){return aa})),e.d(l,"add",(function(){return oa})),e.d(l,"subtract",(function(){return sa})),e.d(l,"multiply",(function(){return ua})),e.d(l,"divide",(function(){return ca})),e.d(l,"ceil",(function(){return ha})),e.d(l,"floor",(function(){return fa})),e.d(l,"min",(function(){return la})),e.d(l,"max",(function(){return da})),e.d(l,"round",(function(){return ma})),e.d(l,"scale",(function(){return pa})),e.d(l,"scaleAndAdd",(function(){return va})),e.d(l,"distance",(function(){return ga})),e.d(l,"squaredDistance",(function(){return Ma})),e.d(l,"length",(function(){return ba})),e.d(l,"squaredLength",(function(){return xa})),e.d(l,"negate",(function(){return wa})),e.d(l,"inverse",(function(){return ya})),e.d(l,"normalize",(function(){return Ta})),e.d(l,"dot",(function(){return Sa})),e.d(l,"cross",(function(){return Va})),e.d(l,"lerp",(function(){return Aa})),e.d(l,"random",(function(){return La})),e.d(l,"transformMat2",(function(){return Da})),e.d(l,"transformMat2d",(function(){return Ea})),e.d(l,"transformMat3",(function(){return Pa})),e.d(l,"transformMat4",(function(){return _a})),e.d(l,"rotate",(function(){return Na})),e.d(l,"angle",(function(){return Ra})),e.d(l,"zero",(function(){return Ia})),e.d(l,"str",(function(){return ja})),e.d(l,"exactEquals",(function(){return Fa})),e.d(l,"equals",(function(){return $a})),e.d(l,"len",(function(){return ka})),e.d(l,"sub",(function(){return qa})),e.d(l,"mul",(function(){return Ba})),e.d(l,"div",(function(){return Oa})),e.d(l,"dist",(function(){return Ca})),e.d(l,"sqrDist",(function(){return Ua})),e.d(l,"sqrLen",(function(){return za})),e.d(l,"forEach",(function(){return Ga}));var d=1e-6,m="undefined"!=typeof Float32Array?Float32Array:Array,p=Math.random;function v(t){m=t}var g=Math.PI/180;function M(t){return t*g}function b(t,n){return Math.abs(t-n)<=d*Math.max(1,Math.abs(t),Math.abs(n))}function x(){var t=new m(4);return m!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function w(t){var n=new m(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function y(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function T(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function S(t,n,e,r){var i=new m(4);return i[0]=t,i[1]=n,i[2]=e,i[3]=r,i}function V(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function A(t,n){if(t===n){var e=n[1];t[1]=n[2],t[2]=e}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}function L(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=e*a-i*r;return o?(o=1/o,t[0]=a*o,t[1]=-r*o,t[2]=-i*o,t[3]=e*o,t):null}function D(t,n){var e=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=e,t}function E(t){return t[0]*t[3]-t[2]*t[1]}function P(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=r*s+a*u,t[1]=i*s+o*u,t[2]=r*c+a*h,t[3]=i*c+o*h,t}function _(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=r*-s+a*u,t[3]=i*-s+o*u,t}function N(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],u=e[1];return t[0]=r*s,t[1]=i*s,t[2]=a*u,t[3]=o*u,t}function R(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=-e,t[3]=r,t}function I(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t}function j(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function F(t){return Math.hypot(t[0],t[1],t[2],t[3])}function $(t,n,e,r){return t[2]=r[2]/r[0],e[0]=r[0],e[1]=r[1],e[3]=r[3]-t[2]*e[1],[t,n,e]}function k(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function q(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function B(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function O(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=n[0],s=n[1],u=n[2],c=n[3];return Math.abs(e-o)<=d*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=d*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-c)<=d*Math.max(1,Math.abs(a),Math.abs(c))}function C(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function U(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});var z=P,G=q;function H(){var t=new m(6);return m!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function X(t){var n=new m(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function Y(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t}function W(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Q(t,n,e,r,i,a){var o=new m(6);return o[0]=t,o[1]=n,o[2]=e,o[3]=r,o[4]=i,o[5]=a,o}function J(t,n,e,r,i,a,o){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t}function Z(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=n[4],s=n[5],u=e*a-r*i;return u?(u=1/u,t[0]=a*u,t[1]=-r*u,t[2]=-i*u,t[3]=e*u,t[4]=(i*s-a*o)*u,t[5]=(r*o-e*s)*u,t):null}function K(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=e[0],h=e[1],f=e[2],l=e[3],d=e[4],m=e[5];return t[0]=r*c+a*h,t[1]=i*c+o*h,t[2]=r*f+a*l,t[3]=i*f+o*l,t[4]=r*d+a*m+s,t[5]=i*d+o*m+u,t}function nt(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=Math.sin(e),h=Math.cos(e);return t[0]=r*h+a*c,t[1]=i*h+o*c,t[2]=r*-c+a*h,t[3]=i*-c+o*h,t[4]=s,t[5]=u,t}function et(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=e[0],h=e[1];return t[0]=r*c,t[1]=i*c,t[2]=a*h,t[3]=o*h,t[4]=s,t[5]=u,t}function rt(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=e[0],h=e[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=r*c+a*h+s,t[5]=i*c+o*h+u,t}function it(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=-e,t[3]=r,t[4]=0,t[5]=0,t}function at(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t}function ot(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ct(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t}function ht(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t}function ft(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t}function lt(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t}function dt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]}function mt(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=n[0],c=n[1],h=n[2],f=n[3],l=n[4],m=n[5];return Math.abs(e-u)<=d*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(r-c)<=d*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=d*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-l)<=d*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(s-m)<=d*Math.max(1,Math.abs(s),Math.abs(m))}var pt=tt,vt=ht;function gt(){var t=new m(9);return m!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Mt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function bt(t){var n=new m(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function xt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function wt(t,n,e,r,i,a,o,s,u){var c=new m(9);return c[0]=t,c[1]=n,c[2]=e,c[3]=r,c[4]=i,c[5]=a,c[6]=o,c[7]=s,c[8]=u,c}function yt(t,n,e,r,i,a,o,s,u,c){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=c,t}function Tt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function St(t,n){if(t===n){var e=n[1],r=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=e,t[5]=n[7],t[6]=r,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function Vt(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=h*o-s*c,l=-h*a+s*u,d=c*a-o*u,m=e*f+r*l+i*d;return m?(m=1/m,t[0]=f*m,t[1]=(-h*r+i*c)*m,t[2]=(s*r-i*o)*m,t[3]=l*m,t[4]=(h*e-i*u)*m,t[5]=(-s*e+i*a)*m,t[6]=d*m,t[7]=(-c*e+r*u)*m,t[8]=(o*e-r*a)*m,t):null}function At(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=n[4],s=n[5],u=n[6],c=n[7],h=n[8];return t[0]=o*h-s*c,t[1]=i*c-r*h,t[2]=r*s-i*o,t[3]=s*u-a*h,t[4]=e*h-i*u,t[5]=i*a-e*s,t[6]=a*c-o*u,t[7]=r*u-e*c,t[8]=e*o-r*a,t}function Lt(t){var n=t[0],e=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8];return n*(c*a-o*u)+e*(-c*i+o*s)+r*(u*i-a*s)}function Dt(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=e[0],d=e[1],m=e[2],p=e[3],v=e[4],g=e[5],M=e[6],b=e[7],x=e[8];return t[0]=l*r+d*o+m*c,t[1]=l*i+d*s+m*h,t[2]=l*a+d*u+m*f,t[3]=p*r+v*o+g*c,t[4]=p*i+v*s+g*h,t[5]=p*a+v*u+g*f,t[6]=M*r+b*o+x*c,t[7]=M*i+b*s+x*h,t[8]=M*a+b*u+x*f,t}function Et(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=e[0],d=e[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l*r+d*o+c,t[7]=l*i+d*s+h,t[8]=l*a+d*u+f,t}function Pt(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=Math.sin(e),d=Math.cos(e);return t[0]=d*r+l*o,t[1]=d*i+l*s,t[2]=d*a+l*u,t[3]=d*o-l*r,t[4]=d*s-l*i,t[5]=d*u-l*a,t[6]=c,t[7]=h,t[8]=f,t}function _t(t,n,e){var r=e[0],i=e[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=i*n[3],t[4]=i*n[4],t[5]=i*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Nt(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function Rt(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=-e,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function It(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function jt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function Ft(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=e+e,s=r+r,u=i+i,c=e*o,h=r*o,f=r*s,l=i*o,d=i*s,m=i*u,p=a*o,v=a*s,g=a*u;return t[0]=1-f-m,t[3]=h-g,t[6]=l+v,t[1]=h+g,t[4]=1-c-m,t[7]=d-p,t[2]=l-v,t[5]=d+p,t[8]=1-c-f,t}function $t(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],m=n[12],p=n[13],v=n[14],g=n[15],M=e*s-r*o,b=e*u-i*o,x=e*c-a*o,w=r*u-i*s,y=r*c-a*s,T=i*c-a*u,S=h*p-f*m,V=h*v-l*m,A=h*g-d*m,L=f*v-l*p,D=f*g-d*p,E=l*g-d*v,P=M*E-b*D+x*L+w*A-y*V+T*S;return P?(P=1/P,t[0]=(s*E-u*D+c*L)*P,t[1]=(u*A-o*E-c*V)*P,t[2]=(o*D-s*A+c*S)*P,t[3]=(i*D-r*E-a*L)*P,t[4]=(e*E-i*A+a*V)*P,t[5]=(r*A-e*D-a*S)*P,t[6]=(p*T-v*y+g*w)*P,t[7]=(v*x-m*T-g*b)*P,t[8]=(m*y-p*x+g*M)*P,t):null}function kt(t,n,e){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/e,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function qt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Bt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ot(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t}function Ct(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t}function Ut(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t}function zt(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t}function Gt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function Ht(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=n[0],l=n[1],m=n[2],p=n[3],v=n[4],g=n[5],M=n[6],b=n[7],x=n[8];return Math.abs(e-f)<=d*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(r-l)<=d*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-m)<=d*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-p)<=d*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-v)<=d*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-g)<=d*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-M)<=d*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-b)<=d*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(h-x)<=d*Math.max(1,Math.abs(h),Math.abs(x))}var Xt=Dt,Yt=Ct;function Wt(){var t=new m(16);return m!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Qt(t){var n=new m(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Jt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function Zt(t,n,e,r,i,a,o,s,u,c,h,f,l,d,p,v){var g=new m(16);return g[0]=t,g[1]=n,g[2]=e,g[3]=r,g[4]=i,g[5]=a,g[6]=o,g[7]=s,g[8]=u,g[9]=c,g[10]=h,g[11]=f,g[12]=l,g[13]=d,g[14]=p,g[15]=v,g}function Kt(t,n,e,r,i,a,o,s,u,c,h,f,l,d,m,p,v){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=f,t[11]=l,t[12]=d,t[13]=m,t[14]=p,t[15]=v,t}function tn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],a=n[6],o=n[7],s=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=a,t[11]=n[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function en(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],m=n[12],p=n[13],v=n[14],g=n[15],M=e*s-r*o,b=e*u-i*o,x=e*c-a*o,w=r*u-i*s,y=r*c-a*s,T=i*c-a*u,S=h*p-f*m,V=h*v-l*m,A=h*g-d*m,L=f*v-l*p,D=f*g-d*p,E=l*g-d*v,P=M*E-b*D+x*L+w*A-y*V+T*S;return P?(P=1/P,t[0]=(s*E-u*D+c*L)*P,t[1]=(i*D-r*E-a*L)*P,t[2]=(p*T-v*y+g*w)*P,t[3]=(l*y-f*T-d*w)*P,t[4]=(u*A-o*E-c*V)*P,t[5]=(e*E-i*A+a*V)*P,t[6]=(v*x-m*T-g*b)*P,t[7]=(h*T-l*x+d*b)*P,t[8]=(o*D-s*A+c*S)*P,t[9]=(r*A-e*D-a*S)*P,t[10]=(m*y-p*x+g*M)*P,t[11]=(f*x-h*y-d*M)*P,t[12]=(s*V-o*L-u*S)*P,t[13]=(e*L-r*V+i*S)*P,t[14]=(p*b-m*w-v*M)*P,t[15]=(h*w-f*b+l*M)*P,t):null}function rn(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],m=n[12],p=n[13],v=n[14],g=n[15];return t[0]=s*(l*g-d*v)-f*(u*g-c*v)+p*(u*d-c*l),t[1]=-(r*(l*g-d*v)-f*(i*g-a*v)+p*(i*d-a*l)),t[2]=r*(u*g-c*v)-s*(i*g-a*v)+p*(i*c-a*u),t[3]=-(r*(u*d-c*l)-s*(i*d-a*l)+f*(i*c-a*u)),t[4]=-(o*(l*g-d*v)-h*(u*g-c*v)+m*(u*d-c*l)),t[5]=e*(l*g-d*v)-h*(i*g-a*v)+m*(i*d-a*l),t[6]=-(e*(u*g-c*v)-o*(i*g-a*v)+m*(i*c-a*u)),t[7]=e*(u*d-c*l)-o*(i*d-a*l)+h*(i*c-a*u),t[8]=o*(f*g-d*p)-h*(s*g-c*p)+m*(s*d-c*f),t[9]=-(e*(f*g-d*p)-h*(r*g-a*p)+m*(r*d-a*f)),t[10]=e*(s*g-c*p)-o*(r*g-a*p)+m*(r*c-a*s),t[11]=-(e*(s*d-c*f)-o*(r*d-a*f)+h*(r*c-a*s)),t[12]=-(o*(f*v-l*p)-h*(s*v-u*p)+m*(s*l-u*f)),t[13]=e*(f*v-l*p)-h*(r*v-i*p)+m*(r*l-i*f),t[14]=-(e*(s*v-u*p)-o*(r*v-i*p)+m*(r*u-i*s)),t[15]=e*(s*l-u*f)-o*(r*l-i*f)+h*(r*u-i*s),t}function an(t){var n=t[0],e=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],f=t[10],l=t[11],d=t[12],m=t[13],p=t[14],v=t[15];return(n*o-e*a)*(f*v-l*p)-(n*s-r*a)*(h*v-l*m)+(n*u-i*a)*(h*p-f*m)+(e*s-r*o)*(c*v-l*d)-(e*u-i*o)*(c*p-f*d)+(r*u-i*s)*(c*m-h*d)}function on(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=n[9],d=n[10],m=n[11],p=n[12],v=n[13],g=n[14],M=n[15],b=e[0],x=e[1],w=e[2],y=e[3];return t[0]=b*r+x*s+w*f+y*p,t[1]=b*i+x*u+w*l+y*v,t[2]=b*a+x*c+w*d+y*g,t[3]=b*o+x*h+w*m+y*M,b=e[4],x=e[5],w=e[6],y=e[7],t[4]=b*r+x*s+w*f+y*p,t[5]=b*i+x*u+w*l+y*v,t[6]=b*a+x*c+w*d+y*g,t[7]=b*o+x*h+w*m+y*M,b=e[8],x=e[9],w=e[10],y=e[11],t[8]=b*r+x*s+w*f+y*p,t[9]=b*i+x*u+w*l+y*v,t[10]=b*a+x*c+w*d+y*g,t[11]=b*o+x*h+w*m+y*M,b=e[12],x=e[13],w=e[14],y=e[15],t[12]=b*r+x*s+w*f+y*p,t[13]=b*i+x*u+w*l+y*v,t[14]=b*a+x*c+w*d+y*g,t[15]=b*o+x*h+w*m+y*M,t}function sn(t,n,e){var r,i,a,o,s,u,c,h,f,l,d,m,p=e[0],v=e[1],g=e[2];return n===t?(t[12]=n[0]*p+n[4]*v+n[8]*g+n[12],t[13]=n[1]*p+n[5]*v+n[9]*g+n[13],t[14]=n[2]*p+n[6]*v+n[10]*g+n[14],t[15]=n[3]*p+n[7]*v+n[11]*g+n[15]):(r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=n[9],d=n[10],m=n[11],t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=f,t[9]=l,t[10]=d,t[11]=m,t[12]=r*p+s*v+f*g+n[12],t[13]=i*p+u*v+l*g+n[13],t[14]=a*p+c*v+d*g+n[14],t[15]=o*p+h*v+m*g+n[15]),t}function un(t,n,e){var r=e[0],i=e[1],a=e[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function cn(t,n,e,r){var i,a,o,s,u,c,h,f,l,m,p,v,g,M,b,x,w,y,T,S,V,A,L,D,E=r[0],P=r[1],_=r[2],N=Math.hypot(E,P,_);return N<d?null:(E*=N=1/N,P*=N,_*=N,i=Math.sin(e),o=1-(a=Math.cos(e)),s=n[0],u=n[1],c=n[2],h=n[3],f=n[4],l=n[5],m=n[6],p=n[7],v=n[8],g=n[9],M=n[10],b=n[11],x=E*E*o+a,w=P*E*o+_*i,y=_*E*o-P*i,T=E*P*o-_*i,S=P*P*o+a,V=_*P*o+E*i,A=E*_*o+P*i,L=P*_*o-E*i,D=_*_*o+a,t[0]=s*x+f*w+v*y,t[1]=u*x+l*w+g*y,t[2]=c*x+m*w+M*y,t[3]=h*x+p*w+b*y,t[4]=s*T+f*S+v*V,t[5]=u*T+l*S+g*V,t[6]=c*T+m*S+M*V,t[7]=h*T+p*S+b*V,t[8]=s*A+f*L+v*D,t[9]=u*A+l*L+g*D,t[10]=c*A+m*L+M*D,t[11]=h*A+p*L+b*D,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function hn(t,n,e){var r=Math.sin(e),i=Math.cos(e),a=n[4],o=n[5],s=n[6],u=n[7],c=n[8],h=n[9],f=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=a*i+c*r,t[5]=o*i+h*r,t[6]=s*i+f*r,t[7]=u*i+l*r,t[8]=c*i-a*r,t[9]=h*i-o*r,t[10]=f*i-s*r,t[11]=l*i-u*r,t}function fn(t,n,e){var r=Math.sin(e),i=Math.cos(e),a=n[0],o=n[1],s=n[2],u=n[3],c=n[8],h=n[9],f=n[10],l=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=a*i-c*r,t[1]=o*i-h*r,t[2]=s*i-f*r,t[3]=u*i-l*r,t[8]=a*r+c*i,t[9]=o*r+h*i,t[10]=s*r+f*i,t[11]=u*r+l*i,t}function ln(t,n,e){var r=Math.sin(e),i=Math.cos(e),a=n[0],o=n[1],s=n[2],u=n[3],c=n[4],h=n[5],f=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=a*i+c*r,t[1]=o*i+h*r,t[2]=s*i+f*r,t[3]=u*i+l*r,t[4]=c*i-a*r,t[5]=h*i-o*r,t[6]=f*i-s*r,t[7]=l*i-u*r,t}function dn(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function mn(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pn(t,n,e){var r,i,a,o=e[0],s=e[1],u=e[2],c=Math.hypot(o,s,u);return c<d?null:(o*=c=1/c,s*=c,u*=c,r=Math.sin(n),a=1-(i=Math.cos(n)),t[0]=o*o*a+i,t[1]=s*o*a+u*r,t[2]=u*o*a-s*r,t[3]=0,t[4]=o*s*a-u*r,t[5]=s*s*a+i,t[6]=u*s*a+o*r,t[7]=0,t[8]=o*u*a+s*r,t[9]=s*u*a-o*r,t[10]=u*u*a+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function vn(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gn(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mn(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bn(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=r+r,u=i+i,c=a+a,h=r*s,f=r*u,l=r*c,d=i*u,m=i*c,p=a*c,v=o*s,g=o*u,M=o*c;return t[0]=1-(d+p),t[1]=f+M,t[2]=l-g,t[3]=0,t[4]=f-M,t[5]=1-(h+p),t[6]=m+v,t[7]=0,t[8]=l+g,t[9]=m-v,t[10]=1-(h+d),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function xn(t,n){var e=new m(3),r=-n[0],i=-n[1],a=-n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=r*r+i*i+a*a+o*o;return f>0?(e[0]=2*(s*o+h*r+u*a-c*i)/f,e[1]=2*(u*o+h*i+c*r-s*a)/f,e[2]=2*(c*o+h*a+s*i-u*r)/f):(e[0]=2*(s*o+h*r+u*a-c*i),e[1]=2*(u*o+h*i+c*r-s*a),e[2]=2*(c*o+h*a+s*i-u*r)),bn(t,n,e),t}function wn(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function yn(t,n){var e=n[0],r=n[1],i=n[2],a=n[4],o=n[5],s=n[6],u=n[8],c=n[9],h=n[10];return t[0]=Math.hypot(e,r,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,c,h),t}function Tn(t,n){var e=new m(3);yn(e,n);var r=1/e[0],i=1/e[1],a=1/e[2],o=n[0]*r,s=n[1]*i,u=n[2]*a,c=n[4]*r,h=n[5]*i,f=n[6]*a,l=n[8]*r,d=n[9]*i,p=n[10]*a,v=o+h+p,g=0;return v>0?(g=2*Math.sqrt(v+1),t[3]=.25*g,t[0]=(f-d)/g,t[1]=(l-u)/g,t[2]=(s-c)/g):o>h&&o>p?(g=2*Math.sqrt(1+o-h-p),t[3]=(f-d)/g,t[0]=.25*g,t[1]=(s+c)/g,t[2]=(l+u)/g):h>p?(g=2*Math.sqrt(1+h-o-p),t[3]=(l-u)/g,t[0]=(s+c)/g,t[1]=.25*g,t[2]=(f+d)/g):(g=2*Math.sqrt(1+p-o-h),t[3]=(s-c)/g,t[0]=(l+u)/g,t[1]=(f+d)/g,t[2]=.25*g),t}function Sn(t,n,e,r){var i=n[0],a=n[1],o=n[2],s=n[3],u=i+i,c=a+a,h=o+o,f=i*u,l=i*c,d=i*h,m=a*c,p=a*h,v=o*h,g=s*u,M=s*c,b=s*h,x=r[0],w=r[1],y=r[2];return t[0]=(1-(m+v))*x,t[1]=(l+b)*x,t[2]=(d-M)*x,t[3]=0,t[4]=(l-b)*w,t[5]=(1-(f+v))*w,t[6]=(p+g)*w,t[7]=0,t[8]=(d+M)*y,t[9]=(p-g)*y,t[10]=(1-(f+m))*y,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Vn(t,n,e,r,i){var a=n[0],o=n[1],s=n[2],u=n[3],c=a+a,h=o+o,f=s+s,l=a*c,d=a*h,m=a*f,p=o*h,v=o*f,g=s*f,M=u*c,b=u*h,x=u*f,w=r[0],y=r[1],T=r[2],S=i[0],V=i[1],A=i[2],L=(1-(p+g))*w,D=(d+x)*w,E=(m-b)*w,P=(d-x)*y,_=(1-(l+g))*y,N=(v+M)*y,R=(m+b)*T,I=(v-M)*T,j=(1-(l+p))*T;return t[0]=L,t[1]=D,t[2]=E,t[3]=0,t[4]=P,t[5]=_,t[6]=N,t[7]=0,t[8]=R,t[9]=I,t[10]=j,t[11]=0,t[12]=e[0]+S-(L*S+P*V+R*A),t[13]=e[1]+V-(D*S+_*V+I*A),t[14]=e[2]+A-(E*S+N*V+j*A),t[15]=1,t}function An(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=e+e,s=r+r,u=i+i,c=e*o,h=r*o,f=r*s,l=i*o,d=i*s,m=i*u,p=a*o,v=a*s,g=a*u;return t[0]=1-f-m,t[1]=h+g,t[2]=l-v,t[3]=0,t[4]=h-g,t[5]=1-c-m,t[6]=d+p,t[7]=0,t[8]=l+v,t[9]=d-p,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ln(t,n,e,r,i,a,o){var s=1/(e-n),u=1/(i-r),c=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(e+n)*s,t[9]=(i+r)*u,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*c,t[15]=0,t}function Dn(t,n,e,r,i){var a,o=1/Math.tan(n/2);return t[0]=o/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(r-i),t[10]=(i+r)*a,t[14]=2*i*r*a):(t[10]=-1,t[14]=-2*r),t}function En(t,n,e,r){var i=Math.tan(n.upDegrees*Math.PI/180),a=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),s=Math.tan(n.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(i+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(i-a)*c*.5,t[10]=r/(e-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*e/(e-r),t[15]=0,t}function Pn(t,n,e,r,i,a,o){var s=1/(n-e),u=1/(r-i),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(n+e)*s,t[13]=(i+r)*u,t[14]=(o+a)*c,t[15]=1,t}function _n(t,n,e,r){var i,a,o,s,u,c,h,f,l,m,p=n[0],v=n[1],g=n[2],M=r[0],b=r[1],x=r[2],w=e[0],y=e[1],T=e[2];return Math.abs(p-w)<d&&Math.abs(v-y)<d&&Math.abs(g-T)<d?tn(t):(h=p-w,f=v-y,l=g-T,i=b*(l*=m=1/Math.hypot(h,f,l))-x*(f*=m),a=x*(h*=m)-M*l,o=M*f-b*h,(m=Math.hypot(i,a,o))?(i*=m=1/m,a*=m,o*=m):(i=0,a=0,o=0),s=f*o-l*a,u=l*i-h*o,c=h*a-f*i,(m=Math.hypot(s,u,c))?(s*=m=1/m,u*=m,c*=m):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=u,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=l,t[11]=0,t[12]=-(i*p+a*v+o*g),t[13]=-(s*p+u*v+c*g),t[14]=-(h*p+f*v+l*g),t[15]=1,t)}function Nn(t,n,e,r){var i=n[0],a=n[1],o=n[2],s=r[0],u=r[1],c=r[2],h=i-e[0],f=a-e[1],l=o-e[2],d=h*h+f*f+l*l;d>0&&(h*=d=1/Math.sqrt(d),f*=d,l*=d);var m=u*l-c*f,p=c*h-s*l,v=s*f-u*h;return(d=m*m+p*p+v*v)>0&&(m*=d=1/Math.sqrt(d),p*=d,v*=d),t[0]=m,t[1]=p,t[2]=v,t[3]=0,t[4]=f*v-l*p,t[5]=l*m-h*v,t[6]=h*p-f*m,t[7]=0,t[8]=h,t[9]=f,t[10]=l,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function Rn(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function In(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function jn(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t[9]=n[9]+e[9],t[10]=n[10]+e[10],t[11]=n[11]+e[11],t[12]=n[12]+e[12],t[13]=n[13]+e[13],t[14]=n[14]+e[14],t[15]=n[15]+e[15],t}function Fn(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t[9]=n[9]-e[9],t[10]=n[10]-e[10],t[11]=n[11]-e[11],t[12]=n[12]-e[12],t[13]=n[13]-e[13],t[14]=n[14]-e[14],t[15]=n[15]-e[15],t}function $n(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12]*e,t[13]=n[13]*e,t[14]=n[14]*e,t[15]=n[15]*e,t}function kn(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t[9]=n[9]+e[9]*r,t[10]=n[10]+e[10]*r,t[11]=n[11]+e[11]*r,t[12]=n[12]+e[12]*r,t[13]=n[13]+e[13]*r,t[14]=n[14]+e[14]*r,t[15]=n[15]+e[15]*r,t}function qn(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function Bn(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=t[9],l=t[10],m=t[11],p=t[12],v=t[13],g=t[14],M=t[15],b=n[0],x=n[1],w=n[2],y=n[3],T=n[4],S=n[5],V=n[6],A=n[7],L=n[8],D=n[9],E=n[10],P=n[11],_=n[12],N=n[13],R=n[14],I=n[15];return Math.abs(e-b)<=d*Math.max(1,Math.abs(e),Math.abs(b))&&Math.abs(r-x)<=d*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-w)<=d*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-y)<=d*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(o-T)<=d*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-S)<=d*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-V)<=d*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(c-A)<=d*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-L)<=d*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(f-D)<=d*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(l-E)<=d*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(m-P)<=d*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-_)<=d*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(v-N)<=d*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(g-R)<=d*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(M-I)<=d*Math.max(1,Math.abs(M),Math.abs(I))}var On=on,Cn=Fn;function Un(){var t=new m(3);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function zn(t){var n=new m(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Gn(t){var n=t[0],e=t[1],r=t[2];return Math.hypot(n,e,r)}function Hn(t,n,e){var r=new m(3);return r[0]=t,r[1]=n,r[2]=e,r}function Xn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Yn(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function Wn(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function Qn(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t}function Jn(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t}function Zn(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t}function Kn(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function te(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function ne(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t}function ee(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t}function re(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function ie(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function ae(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t}function oe(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return Math.hypot(e,r,i)}function se(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return e*e+r*r+i*i}function ue(t){var n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}function ce(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function he(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}function fe(t,n){var e=n[0],r=n[1],i=n[2],a=e*e+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t}function le(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function de(t,n,e){var r=n[0],i=n[1],a=n[2],o=e[0],s=e[1],u=e[2];return t[0]=i*u-a*s,t[1]=a*o-r*u,t[2]=r*s-i*o,t}function me(t,n,e,r){var i=n[0],a=n[1],o=n[2];return t[0]=i+r*(e[0]-i),t[1]=a+r*(e[1]-a),t[2]=o+r*(e[2]-o),t}function pe(t,n,e,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,c=o*(a-1),h=o*(3-2*a);return t[0]=n[0]*s+e[0]*u+r[0]*c+i[0]*h,t[1]=n[1]*s+e[1]*u+r[1]*c+i[1]*h,t[2]=n[2]*s+e[2]*u+r[2]*c+i[2]*h,t}function ve(t,n,e,r,i,a){var o=1-a,s=o*o,u=a*a,c=s*o,h=3*a*s,f=3*u*o,l=u*a;return t[0]=n[0]*c+e[0]*h+r[0]*f+i[0]*l,t[1]=n[1]*c+e[1]*h+r[1]*f+i[1]*l,t[2]=n[2]*c+e[2]*h+r[2]*f+i[2]*l,t}function ge(t,n){n=n||1;var e=2*p()*Math.PI,r=2*p()-1,i=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=r*n,t}function Me(t,n,e){var r=n[0],i=n[1],a=n[2],o=e[3]*r+e[7]*i+e[11]*a+e[15];return o=o||1,t[0]=(e[0]*r+e[4]*i+e[8]*a+e[12])/o,t[1]=(e[1]*r+e[5]*i+e[9]*a+e[13])/o,t[2]=(e[2]*r+e[6]*i+e[10]*a+e[14])/o,t}function be(t,n,e){var r=n[0],i=n[1],a=n[2];return t[0]=r*e[0]+i*e[3]+a*e[6],t[1]=r*e[1]+i*e[4]+a*e[7],t[2]=r*e[2]+i*e[5]+a*e[8],t}function xe(t,n,e){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],u=n[1],c=n[2],h=i*c-a*u,f=a*s-r*c,l=r*u-i*s,d=i*l-a*f,m=a*h-r*l,p=r*f-i*h,v=2*o;return h*=v,f*=v,l*=v,d*=2,m*=2,p*=2,t[0]=s+h+d,t[1]=u+f+m,t[2]=c+l+p,t}function we(t,n,e,r){var i=[],a=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function ye(t,n,e,r){var i=[],a=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function Te(t,n,e,r){var i=[],a=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function Se(t,n){var e=Hn(t[0],t[1],t[2]),r=Hn(n[0],n[1],n[2]);fe(e,e),fe(r,r);var i=le(e,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Ve(t){return t[0]=0,t[1]=0,t[2]=0,t}function Ae(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Le(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function De(t,n){var e=t[0],r=t[1],i=t[2],a=n[0],o=n[1],s=n[2];return Math.abs(e-a)<=d*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=d*Math.max(1,Math.abs(i),Math.abs(s))}var Ee,Pe=Qn,_e=Jn,Ne=Zn,Re=oe,Ie=se,je=Gn,Fe=ue,$e=(Ee=Un(),function(t,n,e,r,i,a){var o,s;for(n||(n=3),e||(e=0),s=r?Math.min(r*n+e,t.length):t.length,o=e;o<s;o+=n)Ee[0]=t[o],Ee[1]=t[o+1],Ee[2]=t[o+2],i(Ee,Ee,a),t[o]=Ee[0],t[o+1]=Ee[1],t[o+2]=Ee[2];return t});function ke(){var t=new m(4);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function qe(t){var n=new m(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Be(t,n,e,r){var i=new m(4);return i[0]=t,i[1]=n,i[2]=e,i[3]=r,i}function Oe(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Ce(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function Ue(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function ze(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function Ge(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t[3]=n[3]*e[3],t}function He(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function Xe(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function Ye(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function We(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t[3]=Math.min(n[3],e[3]),t}function Qe(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t[3]=Math.max(n[3],e[3]),t}function Je(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function Ze(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function Ke(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}function tr(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],a=n[3]-t[3];return Math.hypot(e,r,i,a)}function nr(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],a=n[3]-t[3];return e*e+r*r+i*i+a*a}function er(t){var n=t[0],e=t[1],r=t[2],i=t[3];return Math.hypot(n,e,r,i)}function rr(t){var n=t[0],e=t[1],r=t[2],i=t[3];return n*n+e*e+r*r+i*i}function ir(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function ar(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}function or(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=e*e+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t}function sr(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function ur(t,n,e,r){var i=e[0]*r[1]-e[1]*r[0],a=e[0]*r[2]-e[2]*r[0],o=e[0]*r[3]-e[3]*r[0],s=e[1]*r[2]-e[2]*r[1],u=e[1]*r[3]-e[3]*r[1],c=e[2]*r[3]-e[3]*r[2],h=n[0],f=n[1],l=n[2],d=n[3];return t[0]=f*c-l*u+d*s,t[1]=-h*c+l*o-d*a,t[2]=h*u-f*o+d*i,t[3]=-h*s+f*a-l*i,t}function cr(t,n,e,r){var i=n[0],a=n[1],o=n[2],s=n[3];return t[0]=i+r*(e[0]-i),t[1]=a+r*(e[1]-a),t[2]=o+r*(e[2]-o),t[3]=s+r*(e[3]-s),t}function hr(t,n){var e,r,i,a,o,s;n=n||1;do{o=(e=2*p()-1)*e+(r=2*p()-1)*r}while(o>=1);do{s=(i=2*p()-1)*i+(a=2*p()-1)*a}while(s>=1);var u=Math.sqrt((1-o)/s);return t[0]=n*e,t[1]=n*r,t[2]=n*i*u,t[3]=n*a*u,t}function fr(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3];return t[0]=e[0]*r+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*r+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*r+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*r+e[7]*i+e[11]*a+e[15]*o,t}function lr(t,n,e){var r=n[0],i=n[1],a=n[2],o=e[0],s=e[1],u=e[2],c=e[3],h=c*r+s*a-u*i,f=c*i+u*r-o*a,l=c*a+o*i-s*r,d=-o*r-s*i-u*a;return t[0]=h*c+d*-o+f*-u-l*-s,t[1]=f*c+d*-s+l*-o-h*-u,t[2]=l*c+d*-u+h*-s-f*-o,t[3]=n[3],t}function dr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function mr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function pr(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function vr(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=n[0],s=n[1],u=n[2],c=n[3];return Math.abs(e-o)<=d*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=d*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-c)<=d*Math.max(1,Math.abs(a),Math.abs(c))}var gr=ze,Mr=Ge,br=He,xr=tr,wr=nr,yr=er,Tr=rr,Sr=function(){var t=ke();return function(n,e,r,i,a,o){var s,u;for(e||(e=4),r||(r=0),u=i?Math.min(i*e+r,n.length):n.length,s=r;s<u;s+=e)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],t[3]=n[s+3],a(t,t,o),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2],n[s+3]=t[3];return n}}();function Vr(){var t=new m(4);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ar(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Lr(t,n,e){e*=.5;var r=Math.sin(e);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(e),t}function Dr(t,n){var e=2*Math.acos(n[3]),r=Math.sin(e/2);return r>d?(t[0]=n[0]/r,t[1]=n[1]/r,t[2]=n[2]/r):(t[0]=1,t[1]=0,t[2]=0),e}function Er(t,n){var e=ii(t,n);return Math.acos(2*e*e-1)}function Pr(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=r*h+o*s+i*c-a*u,t[1]=i*h+o*u+a*s-r*c,t[2]=a*h+o*c+r*u-i*s,t[3]=o*h-r*s-i*u-a*c,t}function _r(t,n,e){e*=.5;var r=n[0],i=n[1],a=n[2],o=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-r*s,t}function Nr(t,n,e){e*=.5;var r=n[0],i=n[1],a=n[2],o=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u-a*s,t[1]=i*u+o*s,t[2]=a*u+r*s,t[3]=o*u-i*s,t}function Rr(t,n,e){e*=.5;var r=n[0],i=n[1],a=n[2],o=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function Ir(t,n){var e=n[0],r=n[1],i=n[2];return t[0]=e,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-e*e-r*r-i*i)),t}function jr(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=Math.sqrt(e*e+r*r+i*i),s=Math.exp(a),u=o>0?s*Math.sin(o)/o:0;return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(o),t}function Fr(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=Math.sqrt(e*e+r*r+i*i),s=o>0?Math.atan2(o,a)/o:0;return t[0]=e*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(e*e+r*r+i*i+a*a),t}function $r(t,n,e){return Fr(t,n),ri(t,t,e),jr(t,t),t}function kr(t,n,e,r){var i,a,o,s,u,c=n[0],h=n[1],f=n[2],l=n[3],m=e[0],p=e[1],v=e[2],g=e[3];return(a=c*m+h*p+f*v+l*g)<0&&(a=-a,m=-m,p=-p,v=-v,g=-g),1-a>d?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(s=1-r,u=r),t[0]=s*c+u*m,t[1]=s*h+u*p,t[2]=s*f+u*v,t[3]=s*l+u*g,t}function qr(t){var n=p(),e=p(),r=p(),i=Math.sqrt(1-n),a=Math.sqrt(n);return t[0]=i*Math.sin(2*Math.PI*e),t[1]=i*Math.cos(2*Math.PI*e),t[2]=a*Math.sin(2*Math.PI*r),t[3]=a*Math.cos(2*Math.PI*r),t}function Br(t,n){var e=n[0],r=n[1],i=n[2],a=n[3],o=e*e+r*r+i*i+a*a,s=o?1/o:0;return t[0]=-e*s,t[1]=-r*s,t[2]=-i*s,t[3]=a*s,t}function Or(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t}function Cr(t,n){var e,r=n[0]+n[4]+n[8];if(r>0)e=Math.sqrt(r+1),t[3]=.5*e,e=.5/e,t[0]=(n[5]-n[7])*e,t[1]=(n[6]-n[2])*e,t[2]=(n[1]-n[3])*e;else{var i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;e=Math.sqrt(n[3*i+i]-n[3*a+a]-n[3*o+o]+1),t[i]=.5*e,e=.5/e,t[3]=(n[3*a+o]-n[3*o+a])*e,t[a]=(n[3*a+i]+n[3*i+a])*e,t[o]=(n[3*o+i]+n[3*i+o])*e}return t}function Ur(t,n,e,r){var i=.5*Math.PI/180;n*=i,e*=i,r*=i;var a=Math.sin(n),o=Math.cos(n),s=Math.sin(e),u=Math.cos(e),c=Math.sin(r),h=Math.cos(r);return t[0]=a*u*h-o*s*c,t[1]=o*s*h+a*u*c,t[2]=o*u*c-a*s*h,t[3]=o*u*h+a*s*c,t}function zr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Gr,Hr,Xr,Yr,Wr,Qr,Jr=qe,Zr=Be,Kr=Oe,ti=Ce,ni=Ue,ei=Pr,ri=Ze,ii=sr,ai=cr,oi=er,si=oi,ui=rr,ci=ui,hi=or,fi=pr,li=vr,di=(Gr=Un(),Hr=Hn(1,0,0),Xr=Hn(0,1,0),function(t,n,e){var r=le(n,e);return r<-.999999?(de(Gr,Hr,n),je(Gr)<1e-6&&de(Gr,Xr,n),fe(Gr,Gr),Lr(t,Gr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(de(Gr,n,e),t[0]=Gr[0],t[1]=Gr[1],t[2]=Gr[2],t[3]=1+r,hi(t,t))}),mi=(Yr=Vr(),Wr=Vr(),function(t,n,e,r,i,a){return kr(Yr,n,i,a),kr(Wr,e,r,a),kr(t,Yr,Wr,2*a*(1-a)),t}),pi=(Qr=gt(),function(t,n,e,r){return Qr[0]=e[0],Qr[3]=e[1],Qr[6]=e[2],Qr[1]=r[0],Qr[4]=r[1],Qr[7]=r[2],Qr[2]=-n[0],Qr[5]=-n[1],Qr[8]=-n[2],hi(t,Cr(t,Qr))});function vi(){var t=new m(8);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function gi(t){var n=new m(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function Mi(t,n,e,r,i,a,o,s){var u=new m(8);return u[0]=t,u[1]=n,u[2]=e,u[3]=r,u[4]=i,u[5]=a,u[6]=o,u[7]=s,u}function bi(t,n,e,r,i,a,o){var s=new m(8);s[0]=t,s[1]=n,s[2]=e,s[3]=r;var u=.5*i,c=.5*a,h=.5*o;return s[4]=u*r+c*e-h*n,s[5]=c*r+h*t-u*e,s[6]=h*r+u*n-c*t,s[7]=-u*t-c*n-h*e,s}function xi(t,n,e){var r=.5*e[0],i=.5*e[1],a=.5*e[2],o=n[0],s=n[1],u=n[2],c=n[3];return t[0]=o,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+i*u-a*s,t[5]=i*c+a*o-r*u,t[6]=a*c+r*s-i*o,t[7]=-r*o-i*s-a*u,t}function wi(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t}function yi(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ti(t,n){var e=Vr();Tn(e,n);var r=new m(3);return wn(r,n),xi(t,e,r),t}function Si(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}function Vi(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ai(t,n,e,r,i,a,o,s,u){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t}var Li=Kr;function Di(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t}var Ei=Kr;function Pi(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t}function _i(t,n){var e=n[4],r=n[5],i=n[6],a=n[7],o=-n[0],s=-n[1],u=-n[2],c=n[3];return t[0]=2*(e*c+a*o+r*u-i*s),t[1]=2*(r*c+a*s+i*o-e*u),t[2]=2*(i*c+a*u+e*s-r*o),t}function Ni(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=.5*e[0],u=.5*e[1],c=.5*e[2],h=n[4],f=n[5],l=n[6],d=n[7];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=o*s+i*c-a*u+h,t[5]=o*u+a*s-r*c+f,t[6]=o*c+r*u-i*s+l,t[7]=-r*s-i*u-a*c+d,t}function Ri(t,n,e){var r=-n[0],i=-n[1],a=-n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=s*o+h*r+u*a-c*i,l=u*o+h*i+c*r-s*a,d=c*o+h*a+s*i-u*r,m=h*o-s*r-u*i-c*a;return _r(t,n,e),r=t[0],i=t[1],a=t[2],o=t[3],t[4]=f*o+m*r+l*a-d*i,t[5]=l*o+m*i+d*r-f*a,t[6]=d*o+m*a+f*i-l*r,t[7]=m*o-f*r-l*i-d*a,t}function Ii(t,n,e){var r=-n[0],i=-n[1],a=-n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=s*o+h*r+u*a-c*i,l=u*o+h*i+c*r-s*a,d=c*o+h*a+s*i-u*r,m=h*o-s*r-u*i-c*a;return Nr(t,n,e),r=t[0],i=t[1],a=t[2],o=t[3],t[4]=f*o+m*r+l*a-d*i,t[5]=l*o+m*i+d*r-f*a,t[6]=d*o+m*a+f*i-l*r,t[7]=m*o-f*r-l*i-d*a,t}function ji(t,n,e){var r=-n[0],i=-n[1],a=-n[2],o=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=s*o+h*r+u*a-c*i,l=u*o+h*i+c*r-s*a,d=c*o+h*a+s*i-u*r,m=h*o-s*r-u*i-c*a;return Rr(t,n,e),r=t[0],i=t[1],a=t[2],o=t[3],t[4]=f*o+m*r+l*a-d*i,t[5]=l*o+m*i+d*r-f*a,t[6]=d*o+m*a+f*i-l*r,t[7]=m*o-f*r-l*i-d*a,t}function Fi(t,n,e){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=s*o+h*r+u*a-c*i,t[1]=u*o+h*i+c*r-s*a,t[2]=c*o+h*a+s*i-u*r,t[3]=h*o-s*r-u*i-c*a,s=n[4],u=n[5],c=n[6],h=n[7],t[4]=s*o+h*r+u*a-c*i,t[5]=u*o+h*i+c*r-s*a,t[6]=c*o+h*a+s*i-u*r,t[7]=h*o-s*r-u*i-c*a,t}function $i(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=r*h+o*s+i*c-a*u,t[1]=i*h+o*u+a*s-r*c,t[2]=a*h+o*c+r*u-i*s,t[3]=o*h-r*s-i*u-a*c,s=e[4],u=e[5],c=e[6],h=e[7],t[4]=r*h+o*s+i*c-a*u,t[5]=i*h+o*u+a*s-r*c,t[6]=a*h+o*c+r*u-i*s,t[7]=o*h-r*s-i*u-a*c,t}function ki(t,n,e,r){if(Math.abs(r)<d)return Si(t,n);var i=Math.hypot(e[0],e[1],e[2]);r*=.5;var a=Math.sin(r),o=a*e[0]/i,s=a*e[1]/i,u=a*e[2]/i,c=Math.cos(r),h=n[0],f=n[1],l=n[2],m=n[3];t[0]=h*c+m*o+f*u-l*s,t[1]=f*c+m*s+l*o-h*u,t[2]=l*c+m*u+h*s-f*o,t[3]=m*c-h*o-f*s-l*u;var p=n[4],v=n[5],g=n[6],M=n[7];return t[4]=p*c+M*o+v*u-g*s,t[5]=v*c+M*s+g*o-p*u,t[6]=g*c+M*u+p*s-v*o,t[7]=M*c-p*o-v*s-g*u,t}function qi(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t}function Bi(t,n,e){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[4],u=e[5],c=e[6],h=e[7],f=n[4],l=n[5],d=n[6],m=n[7],p=e[0],v=e[1],g=e[2],M=e[3];return t[0]=r*M+o*p+i*g-a*v,t[1]=i*M+o*v+a*p-r*g,t[2]=a*M+o*g+r*v-i*p,t[3]=o*M-r*p-i*v-a*g,t[4]=r*h+o*s+i*c-a*u+f*M+m*p+l*g-d*v,t[5]=i*h+o*u+a*s-r*c+l*M+m*v+d*p-f*g,t[6]=a*h+o*c+r*u-i*s+d*M+m*g+f*v-l*p,t[7]=o*h-r*s-i*u-a*c+m*M-f*p-l*v-d*g,t}var Oi=Bi;function Ci(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t}var Ui=ii;function zi(t,n,e,r){var i=1-r;return Ui(n,e)<0&&(r=-r),t[0]=n[0]*i+e[0]*r,t[1]=n[1]*i+e[1]*r,t[2]=n[2]*i+e[2]*r,t[3]=n[3]*i+e[3]*r,t[4]=n[4]*i+e[4]*r,t[5]=n[5]*i+e[5]*r,t[6]=n[6]*i+e[6]*r,t[7]=n[7]*i+e[7]*r,t}function Gi(t,n){var e=Wi(n);return t[0]=-n[0]/e,t[1]=-n[1]/e,t[2]=-n[2]/e,t[3]=n[3]/e,t[4]=-n[4]/e,t[5]=-n[5]/e,t[6]=-n[6]/e,t[7]=n[7]/e,t}function Hi(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t}var Xi=oi,Yi=Xi,Wi=ui,Qi=Wi;function Ji(t,n){var e=Wi(n);if(e>0){e=Math.sqrt(e);var r=n[0]/e,i=n[1]/e,a=n[2]/e,o=n[3]/e,s=n[4],u=n[5],c=n[6],h=n[7],f=r*s+i*u+a*c+o*h;t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=(s-r*f)/e,t[5]=(u-i*f)/e,t[6]=(c-a*f)/e,t[7]=(h-o*f)/e}return t}function Zi(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Ki(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]}function ta(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=n[0],f=n[1],l=n[2],m=n[3],p=n[4],v=n[5],g=n[6],M=n[7];return Math.abs(e-h)<=d*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-l)<=d*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-m)<=d*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-p)<=d*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-v)<=d*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-g)<=d*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-M)<=d*Math.max(1,Math.abs(c),Math.abs(M))}function na(){var t=new m(2);return m!=Float32Array&&(t[0]=0,t[1]=0),t}function ea(t){var n=new m(2);return n[0]=t[0],n[1]=t[1],n}function ra(t,n){var e=new m(2);return e[0]=t,e[1]=n,e}function ia(t,n){return t[0]=n[0],t[1]=n[1],t}function aa(t,n,e){return t[0]=n,t[1]=e,t}function oa(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t}function sa(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t}function ua(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t}function ca(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t}function ha(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function fa(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function la(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t}function da(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t}function ma(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function pa(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t}function va(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t}function ga(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.hypot(e,r)}function Ma(t,n){var e=n[0]-t[0],r=n[1]-t[1];return e*e+r*r}function ba(t){var n=t[0],e=t[1];return Math.hypot(n,e)}function xa(t){var n=t[0],e=t[1];return n*n+e*e}function wa(t,n){return t[0]=-n[0],t[1]=-n[1],t}function ya(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function Ta(t,n){var e=n[0],r=n[1],i=e*e+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=n[0]*i,t[1]=n[1]*i,t}function Sa(t,n){return t[0]*n[0]+t[1]*n[1]}function Va(t,n,e){var r=n[0]*e[1]-n[1]*e[0];return t[0]=t[1]=0,t[2]=r,t}function Aa(t,n,e,r){var i=n[0],a=n[1];return t[0]=i+r*(e[0]-i),t[1]=a+r*(e[1]-a),t}function La(t,n){n=n||1;var e=2*p()*Math.PI;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t}function Da(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[2]*i,t[1]=e[1]*r+e[3]*i,t}function Ea(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[2]*i+e[4],t[1]=e[1]*r+e[3]*i+e[5],t}function Pa(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[3]*i+e[6],t[1]=e[1]*r+e[4]*i+e[7],t}function _a(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[4]*i+e[12],t[1]=e[1]*r+e[5]*i+e[13],t}function Na(t,n,e,r){var i=n[0]-e[0],a=n[1]-e[1],o=Math.sin(r),s=Math.cos(r);return t[0]=i*s-a*o+e[0],t[1]=i*o+a*s+e[1],t}function Ra(t,n){var e=t[0],r=t[1],i=n[0],a=n[1],o=e*e+r*r;o>0&&(o=1/Math.sqrt(o));var s=i*i+a*a;s>0&&(s=1/Math.sqrt(s));var u=(e*i+r*a)*o*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}function Ia(t){return t[0]=0,t[1]=0,t}function ja(t){return"vec2("+t[0]+", "+t[1]+")"}function Fa(t,n){return t[0]===n[0]&&t[1]===n[1]}function $a(t,n){var e=t[0],r=t[1],i=n[0],a=n[1];return Math.abs(e-i)<=d*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-a)<=d*Math.max(1,Math.abs(r),Math.abs(a))}var ka=ba,qa=sa,Ba=ua,Oa=ca,Ca=ga,Ua=Ma,za=xa,Ga=function(){var t=na();return function(n,e,r,i,a,o){var s,u;for(e||(e=2),r||(r=0),u=i?Math.min(i*e+r,n.length):n.length,s=r;s<u;s+=e)t[0]=n[s],t[1]=n[s+1],a(t,t,o),n[s]=t[0],n[s+1]=t[1];return n}}();e.d(n,"glMatrix",(function(){return r})),e.d(n,"mat2",(function(){return i})),e.d(n,"mat2d",(function(){return a})),e.d(n,"mat3",(function(){return o})),e.d(n,"mat4",(function(){return s})),e.d(n,"quat",(function(){return h})),e.d(n,"quat2",(function(){return f})),e.d(n,"vec2",(function(){return l})),e.d(n,"vec3",(function(){return u})),e.d(n,"vec4",(function(){return c}))},function(t,n,e){var r,i;r=[e,n,e(0),e(4)],void 0===(i=function(t,n,e,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.SGNode=class{constructor(t,n){this.parent=null,this.lights=[],this.scenegraph=t,this.setName(n)}addLight(t){this.lights.push(t)}getNumLights(){return this.lights.length}getLights(t){let n=[];return this.lights.forEach(i=>{let a=new r.Light;a.setAmbient(i.getAmbient()),a.setDiffuse(i.getDiffuse()),a.setSpecular(i.getSpecular()),a.setSpotAngle(i.getSpotCutoff());let o=i.getPosition();e.vec4.transformMat4(o,o,t.peek()),0!=o[3]?a.setPosition([o[0],o[1],o[2]]):a.setDirection([o[0],o[1],o[2]]),o=i.getSpotDirection(),e.vec4.transformMat4(o,o,t.peek()),a.setSpotDirection(e.vec3.fromValues(o[0],o[1],o[2])),n.push(a)}),n}getNode(t){return this.name==t?this:null}setParent(t){this.parent=t}setScenegraph(t){this.scenegraph=t,t.addNode(this.name,this)}setName(t){this.name=t}getName(){return this.name}setTransform(t){throw new Error("Not supported")}setAnimationTransform(t){throw new Error("Not supported")}setMaterial(t){throw new Error("Not supported")}getMaterial(){throw new Error("Not supported")}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r;void 0===(r=function(t,n){"use strict";function e(t,n,e){let r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw"could not compile my shader:"+n+":"+t.getShaderInfoLog(r);return r}function r(t,n){for(var e=["webgl","experimental-webgl"],r=0;r<e.length;++r)try{return t.getContext("webgl",n)}catch(t){}return null}function i(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"}Object.defineProperty(n,"__esModule",{value:!0}),n.loadTexture=function(t,n){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);const r=t.RGBA,i=t.RGBA,a=t.UNSIGNED_BYTE,o=new Uint8Array([0,0,255,255]);t.texImage2D(t.TEXTURE_2D,0,r,1,1,0,i,a,o);const s=new Image;return s.src=n,s.addEventListener("load",()=>{t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,r,i,a,s),t.generateMipmap(t.TEXTURE_2D)}),e},n.setupWebGL=function(t,n){var e=r(t,n);return e&&e instanceof WebGLRenderingContext||(document.getElementsByTagName("body")[0].innerHTML=i(a)),e},n.createShaderProgram=function(t,n,r){let i=t.createProgram(),a=e(t,n,t.VERTEX_SHADER),o=e(t,r,t.FRAGMENT_SHADER);if(t.attachShader(i,a),t.attachShader(i,o),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw"Could not link shader: "+t.getProgramInfoLog(i);return i},n.createShader=e,n.create3DContext=r,n.createErrorHTML=i;let a='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'}.apply(n,[e,n]))||(t.exports=r)},function(t,n,e){var r,i;r=[e,n,e(0)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){let n;!function(t){t[t.Triangle=0]="Triangle",t[t.TriangleFan=1]="TriangleFan",t[t.TriangleStrip=2]="TriangleStrip",t[t.Lines=3]="Lines",t[t.LineStrip=4]="LineStrip",t[t.LineLoop=5]="LineLoop"}(n=t.FaceType||(t.FaceType={}));class r{constructor(){this.vertexData=[],this.indices=[],this.faceType=n.Triangle,this.minBounds=e.vec4.create(),this.maxBounds=e.vec4.create()}getFaceType(){return this.faceType}getNumIndices(){return this.indices.length}getVertexCount(){return this.vertexData.length}getMinimumBounds(){return e.vec4.clone(this.minBounds)}getMaximumBounds(){return e.vec4.clone(this.maxBounds)}getVertexAttributes(){return this.vertexData}getIndices(){return this.indices}setVertexData(t){this.vertexData=t,this.computeBoundingBox()}setPrimitives(t,n){this.indices=t,this.faceType=n}computeBoundingBox(){let t;if(this.vertexData.length<=0)return;if(!this.vertexData[0].hasData("position"))return;let n=[];for(let t of this.vertexData){let r=t.getData("position"),i=e.vec4.fromValues(0,0,0,1);for(let t=0;t<r.length;t++)i[t]=r[t];n.push(i)}for(this.minBounds=e.vec4.clone(n[0]),this.maxBounds=e.vec4.clone(n[0]),t=0;t<n.length;t++){let e=n[t];for(let t=0;t<3;t++)e[t]<this.minBounds[t]&&(this.minBounds[t]=e[t]),e[t]>this.maxBounds[t]&&(this.maxBounds[t]=e[t])}}computeNormals(){let t,n;if(this.vertexData.length<=0)return;if(!this.vertexData[0].hasData("position"))return;if(!this.vertexData[0].hasData("normal"))return;let r=[];this.vertexData.forEach(t=>{let n=t.getData("position"),i=e.vec4.fromValues(0,0,0,1);for(let t=0;t<n.length;t++)i[t]=n[t];r.push(i)});let i=[];for(let t=0;t<r.length;t++)i.push(e.vec4.fromValues(0,0,0,0));for(let t=0;t<this.indices.length;t+=3){let a=e.vec3.fromValues(0,0,0),o=[0,0,0];for(let n=0;n<3;n++)o[n]=this.indices[t+n];for(let t=0;t<3;t++)for(let n=0;n<3;n++)a[n]+=(r[o[t]][(n+1)%3]-r[o[(t+1)%3]][(n+1)%3])*(r[o[t]][(n+2)%3]+r[o[(t+1)%3]][(n+2)%3]);for(e.vec3.normalize(a,a),n=0;n<3;n++)i[o[n]]=e.vec4.add(i[o[n]],i[o[n]],e.vec4.fromValues(a[0],a[1],a[2],0))}for(t=0;t<i.length;t++){let n=e.vec3.fromValues(i[t][0],i[t][1],i[t][2]);e.vec3.normalize(n,n),i[t]=e.vec4.fromValues(n[0],n[1],n[2],0)}for(t=0;t<this.vertexData.length;t++)this.vertexData[t].setData("normal",[i[t][0],i[t][1],i[t][2]])}convertToWireframe(){let t,e=new r;e.setVertexData(this.vertexData);let i=[];switch(this.faceType){case n.Triangle:for(t=0;t<this.indices.length;t+=3)i.push(this.indices[t]),i.push(this.indices[t+1]),i.push(this.indices[t+1]),i.push(this.indices[t+2]),i.push(this.indices[t+2]),i.push(this.indices[t]);break;case n.TriangleFan:for(t=1;t<this.indices.length-1;t+=1)i.push(this.indices[0]),i.push(this.indices[t]),i.push(this.indices[t]),i.push(this.indices[t+1]),i.push(this.indices[0]),i.push(this.indices[t+1]);break;case n.TriangleStrip:for(t=0;t<this.indices.length-2;t++)i.push(this.indices[t]),i.push(this.indices[t+1]),i.push(this.indices[t+1]),i.push(this.indices[t+2]),i.push(this.indices[t+2]),i.push(this.indices[t])}return e.setPrimitives(i,n.Lines),e}}t.PolygonMesh=r;class i{constructor(t){this.mesh=t}getMesh(){return this.mesh}}t.DecoratedMesh=i;t.CanonicalMesh=class extends i{constructor(t){super(t),this.resizeAndCenter()}resizeAndCenter(){let t=this.mesh.getVertexAttributes();if(this.mesh.getVertexCount()<3)return;let n,r=e.vec3.fromValues(0,0,0),i=e.vec3.fromValues(t[0].getData("position")[0],t[0].getData("position")[1],t[0].getData("position")[2]),a=e.vec3.fromValues(i[0],i[1],i[2]);t[0].getData("position").length;t.forEach(t=>{let e=t.getData("position");for(n=0;n<e.length;n++)e[n]<i[n]&&(i[n]=e[n]),e[n]>a[n]&&(a[n]=e[n])}),e.vec3.add(r,i,a),e.vec3.scale(r,r,.5);let o=Math.max(a[0]-i[0],a[1]-i[1],a[2]-i[2]),s=e.mat4.create();for(e.mat4.scale(s,s,e.vec3.fromValues(1/o,1/o,1/o)),e.mat4.translate(s,s,e.vec3.negate(r,r)),n=0;n<t.length;n++){let r=t[n].getData("position"),i=e.vec4.fromValues(r[0],r[1],r[2],1);e.vec4.transformMat4(i,i,s),t[n].setData("position",[i[0],i[1],i[2],i[3]])}}}}(n.Mesh||(n.Mesh={}))}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(0)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Light=class{constructor(){this.ambient=e.vec3.fromValues(0,0,0),this.diffuse=e.vec3.fromValues(0,0,0),this.specular=e.vec3.fromValues(0,0,0),this.position=e.vec4.fromValues(0,0,0,1),this.spotDirection=e.vec4.fromValues(0,0,0,0),this.spotCutoff=0}setAmbient(t){this.ambient=e.vec3.fromValues(t[0],t[1],t[2])}setDirection(t){this.position=e.vec4.fromValues(t[0],t[1],t[2],0)}setSpotDirection(t){this.spotDirection=e.vec4.fromValues(t[0],t[1],t[2],0)}setDiffuse(t){this.diffuse=e.vec3.fromValues(t[0],t[1],t[2])}setSpecular(t){this.specular=e.vec3.fromValues(t[0],t[1],t[2])}setSpotAngle(t){this.spotCutoff=t}setPosition(t){this.position=e.vec4.fromValues(t[0],t[1],t[2],1)}getAmbient(){return e.vec3.fromValues(this.ambient[0],this.ambient[1],this.ambient[2])}getDiffuse(){return e.vec3.fromValues(this.diffuse[0],this.diffuse[1],this.diffuse[2])}getSpecular(){return e.vec3.fromValues(this.specular[0],this.specular[1],this.specular[2])}getPosition(){return e.vec4.fromValues(this.position[0],this.position[1],this.position[2],this.position[3])}getSpotDirection(){return e.vec4.fromValues(this.spotDirection[0],this.spotDirection[1],this.spotDirection[2],this.spotDirection[3])}getSpotCutoff(){return this.spotCutoff}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(6),e(2),e(22),e(23)],void 0===(i=function(t,n,e,r,i,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=0,s=-1;!function(){let t,n,u;window.onload=c=>{var h=document.querySelector("#glCanvas");if(!h)return void console.log("Failed to retrieve the <canvas> element");if(null==(t=r.setupWebGL(h,{antialias:!1,alpha:!1,depth:!0,stencil:!1})))return void alert("Unable to initialize WebGL. Your browser or machine may not support it.");console.log("Window loaded");let f=new a.RTView;n=new e.View(t,f),(u=new i.Controller(n)).go();var l=function(){if(-1==s&&(s=(new Date).getTime()),(o+=1)>=100){let t=(new Date).getTime();s=t,o=0}n.animate(),n.draw(),requestAnimationFrame(l)};l()},window.onbeforeunload=t=>n.freeMeshes()}()}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(0),e(2),e(7),e(8),e(9),e(10),e(13),e(21)],void 0===(i=function(t,n,e,r,i,a,o,s,u,c){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.View=class{constructor(t,n){this.gl=t,this.time=0,this.modelview=new i.Stack,this.scenegraph=null,this.rayTraceView=n,this.gl.clearColor(.9,.9,.7,1),this.proj=e.mat4.perspective(e.mat4.create(),1,e.glMatrix.toRadian(60),.1,1e4),this.gl.viewport(0,0,800,800)}getNumLights(){return this.scenegraph.getNumLights()}initShaders(t,n){this.shaderProgram=r.createShaderProgram(this.gl,t,n),this.gl.useProgram(this.shaderProgram),this.shaderLocations=new o.ShaderLocationsVault(this.gl,this.shaderProgram)}initRenderer(){let t=new Map;t.set("vPosition","position"),t.set("vNormal","normal");let n=new s.ScenegraphRenderer(this.gl,this.shaderLocations,t);this.scenegraph.setRenderer(n)}initScenegraph(){return new Promise(t=>{u.ScenegraphJSONImporter.importJSON(new a.VertexPNTProducer,this.json()).then(n=>{this.scenegraph=n,t()})})}face(){return'\n    {\n      "instances": [\n        {\n          "name": "sphere",\n          "path": "models/sphere.obj"\n        },\n        {\n          "name": "box",\n          "path": "models/box.obj"\n        },\n        {\n          "name": "cylinder",\n          "path": "models/cylinder.obj"\n        },\n        {\n          "name": "cone",\n          "path": "models/cone.obj"\n        }\n      ],\n      "images": [\n        {\n          "name": "checkerboard",\n          "path": "textures/checkerboard.png"\n        },\n        {\n          "name": "earth",\n          "path": "textures/earthmap.png"\n        },\n        {\n          "name": "white",\n          "path": "textures/white.png"\n        }\n      ],\n      "root": {\n        "type": "group",\n        "name": "Root of scene graph",\n        "lights": [\n          {\n            "ambient": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "diffuse": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "specular": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "position": [\n              0.0,\n              100.0,\n              0.0,\n              1.0\n            ],\n            "spotdirection": [\n              0.0,\n              -1.0,\n              0.0,\n              0.0\n            ],\n            "spotcutoff": 25.0\n          }\n        ],\n        "children": [\n          {\n            "type": "transform",\n            "transform": [\n              {\n                "scale": [\n                  200.0,\n                  5.0,\n                  200.0\n                ]\n              }\n            ],\n            "child": {\n              "type": "object",\n              "instanceof": "box",\n              "material": {\n                "ambient": [\n                  0.2,\n                  0.2,\n                  0.2,\n                  1.0\n                ],\n                "diffuse": [\n                  0.8,\n                  0.8,\n                  0.8,\n                  1.0\n                ],\n                "specular": [\n                  0.8,\n                  0.8,\n                  0.8,\n                  1.0\n                ],\n                "emission": [\n                  0.0,\n                  0.0,\n                  0.0,\n                  1.0\n                ],\n                "shininess": 100.0,\n                "absorption": 1.0,\n                "reflection": 0.0,\n                "transparency": 0.0,\n                "refractive_index": 0.0\n              }\n            }\n          },\n          {\n            "type": "transform",\n            "transform": [\n              {\n                "translate": [\n                  0.0,\n                  25.0,\n                  0.0\n                ]\n              }\n            ],\n            "child": {\n              "type": "group",\n              "name": "face",\n              "children": [\n                {\n                  "type": "transform",\n                  "name": "actualface",\n                  "lights": [\n                    {\n                      "ambient": [\n                        0.4,\n                        0.4,\n                        0.4\n                      ],\n                      "diffuse": [\n                        0.4,\n                        0.4,\n                        0.4\n                      ],\n                      "specular": [\n                        0.4,\n                        0.4,\n                        0.4\n                      ],\n                      "position": [\n                        0.0,\n                        100.0,\n                        100.0,\n                        1.0\n                      ],\n                      "spotdirection": [\n                        0.0,\n                        0.0,\n                        1.0,\n                        0.0\n                      ],\n                      "spotcutoff": 180.0\n                    }\n                  ],\n                  "transform": [\n                    {\n                      "scale": [\n                        20.0,\n                        25.0,\n                        20.0\n                      ]\n                    }\n                  ],\n                  "child": {\n                    "type": "object",\n                    "instanceof": "sphere",\n                    "texture": "earth",\n                    "material": {\n                      "ambient": [\n                        0.2,\n                        0.2,\n                        0.1,\n                        1.0\n                      ],\n                      "diffuse": [\n                        0.8,\n                        0.8,\n                        0.6,\n                        1.0\n                      ],\n                      "specular": [\n                        0.8,\n                        0.8,\n                        0.6,\n                        1.0\n                      ],\n                      "emission": [\n                        0.0,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "shininess": 100.0,\n                      "absorption": 1.0,\n                      "reflection": 0.0,\n                      "transparency": 0.0,\n                      "refractive_index": 0.0\n                    }\n                  }\n                },\n                {\n                  "type": "transform",\n                  "name": "lefteye",\n                  "transform": [\n                    {\n                      "translate": [\n                        7.0,\n                        15.0,\n                        12.0\n                      ]\n                    },\n                    {\n                      "scale": [\n                        3.0,\n                        4.0,\n                        3.0\n                      ]\n                    }\n                  ],\n                  "child": {\n                    "type": "object",\n                    "instanceof": "sphere",\n                    "material": {\n                      "ambient": [\n                        0.1,\n                        0.1,\n                        0.1,\n                        1.0\n                      ],\n                      "diffuse": [\n                        0.2,\n                        0.2,\n                        0.2,\n                        1.0\n                      ],\n                      "specular": [\n                        0.9,\n                        0.9,\n                        0.9,\n                        1.0\n                      ],\n                      "emission": [\n                        0.0,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "shininess": 100.0,\n                      "absorption": 1.0,\n                      "reflection": 0.0,\n                      "transparency": 0.0,\n                      "refractive_index": 0.0\n                    }\n                  }\n                },\n                {\n                  "type": "transform",\n                  "name": "righteye",\n                  "transform": [\n                    {\n                      "translate": [\n                        -7.0,\n                        15.0,\n                        12.0\n                      ]\n                    },\n                    {\n                      "scale": [\n                        3.0,\n                        4.0,\n                        3.0\n                      ]\n                    }\n                  ],\n                  "child": {\n                    "type": "object",\n                    "instanceof": "sphere",\n                    "material": {\n                      "ambient": [\n                        0.1,\n                        0.1,\n                        0.1,\n                        1.0\n                      ],\n                      "diffuse": [\n                        0.2,\n                        0.2,\n                        0.2,\n                        1.0\n                      ],\n                      "specular": [\n                        0.9,\n                        0.9,\n                        0.9,\n                        1.0\n                      ],\n                      "emission": [\n                        0.0,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "shininess": 100.0,\n                      "absorption": 1.0,\n                      "reflection": 0.0,\n                      "transparency": 0.0,\n                      "refractive_index": 0.0\n                    }\n                  }\n                },\n                {\n                  "type": "transform",\n                  "name": "nose",\n                  "transform": [\n                    {\n                      "translate": [\n                        0.0,\n                        10.0,\n                        10.0\n                      ]\n                    },\n                    {\n                      "rotate": [\n                        90.0,\n                        1.0,\n                        0.0,\n                        0.0\n                      ]\n                    },\n                    {\n                      "scale": [\n                        5.0,\n                        20.0,\n                        5.0\n                      ]\n                    }\n                  ],\n                  "child": {\n                    "type": "object",\n                    "instanceof": "cylinder",\n                    "material": {\n                      "ambient": [\n                        0.2,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "diffuse": [\n                        0.8,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "specular": [\n                        0.8,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "emission": [\n                        0.0,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "shininess": 100.0,\n                      "absorption": 1.0,\n                      "reflection": 0.0,\n                      "transparency": 0.0,\n                      "refractive_index": 0.0\n                    }\n                  }\n                },\n                {\n                  "type": "transform",\n                  "name": "hat",\n                  "transform": [\n                    {\n                      "translate": [\n                        0.0,\n                        20.0,\n                        0.0\n                      ]\n                    },\n                    {\n                      "scale": [\n                        10.0,\n                        25.0,\n                        10.0\n                      ]\n                    }\n                  ],\n                  "child": {\n                    "type": "object",\n                    "instanceof": "cone",\n                    "material": {\n                      "ambient": [\n                        0.1,\n                        0.0,\n                        0.1,\n                        1.0\n                      ],\n                      "diffuse": [\n                        0.8,\n                        0.0,\n                        0.8,\n                        1.0\n                      ],\n                      "specular": [\n                        0.8,\n                        0.0,\n                        0.8,\n                        1.0\n                      ],\n                      "emission": [\n                        0.0,\n                        0.0,\n                        0.0,\n                        1.0\n                      ],\n                      "shininess": 100.0,\n                      "absorption": 1.0,\n                      "reflection": 0.0,\n                      "transparency": 0.0,\n                      "refractive_index": 0.0\n                    }\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n    \n    \n    '}json2(){return'\n        {\n            "instances": [\n            {\n                "name": "box",\n                "path": "models/box.obj"\n            }\n            ],\n            "root": {\n                "type": "group",\n                "name": "root",\n                "lights": [\n          {\n            "ambient": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "diffuse": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "specular": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "position": [\n              0.0,\n              100.0,\n              0.0,\n              1.0\n            ],\n            "spotdirection": [\n              0.0,\n              -1.0,\n              0.0,\n              0.0\n            ],\n            "spotcutoff": 50.0\n          }\n        ],\n                "children": [\n                    {\n                        "type":"transform",\n                        "name": "box-transform",\n                        "transform": [\n                            {"scale": [50,50,-50]}\n                        ],\n                        "child": {\n                            "type": "object",\n                            "name": "boxnode",\n                            "instanceof": "box",\n                            "material": \n                            {\n                              "ambient": [\n                                0.1,\n                                0.0,\n                                0.1,\n                                1.0\n                              ],\n                              "diffuse": [\n                                0.8,\n                                0.0,\n                                0.8,\n                                1.0\n                              ],\n                              "specular": [\n                                0.8,\n                                0.0,\n                                0.8,\n                                1.0\n                              ],\n                              "emission": [\n                                0.0,\n                                0.0,\n                                0.0,\n                                1.0\n                              ],\n                              "shininess": 100.0,\n                              "absorption": 1.0,\n                              "reflection": 0.0,\n                              "transparency": 0.0,\n                              "refractive_index": 0.0\n                            }\n                        }\n                    }\n                ]\n            }\n        }\n        '}json(){return'\n        {\n            "instances": [\n            {\n                "name": "sphere",\n                "path": "models/sphere.obj"\n            }\n            ],\n            "root": {\n                "type": "group",\n                "name": "root",\n                "lights": [\n          {\n            "ambient": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "diffuse": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "specular": [\n              0.8,\n              0.8,\n              0.8\n            ],\n            "position": [\n              0.0,\n              100.0,\n              0.0,\n              1.0\n            ],\n            "spotdirection": [\n              0.0,\n              -1.0,\n              0.0,\n              0.0\n            ],\n            "spotcutoff": 50.0\n          }\n        ],\n                "children": [\n                    {\n                        "type":"transform",\n                        "name": "sphere-transform",\n                        "transform": [\n                            {"scale": [50,50,-50]}\n                        ],\n                        "child": {\n                            "type": "object",\n                            "name": "spherenode",\n                            "instanceof": "sphere",\n                            "material": \n                            {\n                              "ambient": [\n                                0.1,\n                                0.0,\n                                0.1,\n                                1.0\n                              ],\n                              "diffuse": [\n                                0.8,\n                                0.0,\n                                0.8,\n                                1.0\n                              ],\n                              "specular": [\n                                0.8,\n                                0.0,\n                                0.8,\n                                1.0\n                              ],\n                              "emission": [\n                                0.0,\n                                0.0,\n                                0.0,\n                                1.0\n                              ],\n                              "shininess": 100.0,\n                              "absorption": 1.0,\n                              "reflection": 0.0,\n                              "transparency": 0.0,\n                              "refractive_index": 0.0\n                            }\n                        }\n                    }\n                ]\n            }\n        }\n        '}animate(){this.time+=1,null!=this.scenegraph&&this.scenegraph.animate(this.time),this.draw()}draw(){if(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),null==this.scenegraph)return;for(this.gl.useProgram(this.shaderProgram);!this.modelview.isEmpty();)this.modelview.pop();this.modelview.push(e.mat4.create()),this.modelview.push(e.mat4.clone(this.modelview.peek()));let t=e.vec3.fromValues(0,0,500),n=e.vec3.create();e.mat4.lookAt(this.modelview.peek(),t,e.vec3.fromValues(0,0,0),e.vec3.fromValues(0,1,0)),e.mat4.getTranslation(n,this.modelview.peek());let r=[];r=this.rayTrace(800,800,this.modelview,t),this.gl.uniformMatrix4fv(this.shaderLocations.getUniformLocation("projection"),!1,this.proj),this.rayTraceView.fillCanvas(r,800,800),this.scenegraph.draw(this.modelview)}rayTrace(t,n,r,i){let a,o,s=[];for(a=-n/2;a<n/2;a++)for(o=-t/2;o<t/2;o++){let t=e.vec3.fromValues(i[0]+o,i[1]+a,0),n=e.vec3.create(),u=e.vec3.create(),h=e.vec3.create();e.vec3.scale(n,e.vec3.fromValues(0,0,1),i[2]),e.vec3.scale(u,e.vec3.fromValues(1,0,0),t[0]),e.vec3.scale(h,e.vec3.fromValues(0,1,0),t[1]);let f=e.vec3.create();e.vec3.add(f,n,u),e.vec3.add(f,f,h);let l=new c.Ray(i,f),d=this.rayCast(l,r);s.push(d)}return s}rayCast(t,n){let r=e.vec3.fromValues(0,0,0),i=(e.vec3.fromValues(1,0,0),e.vec3.fromValues(1,1,1));e.vec3.create();return this.scenegraph.closest_intersection(t,n).getTime()<1/0?i:r}freeMeshes(){this.scenegraph.dispose()}setFeatures(t){}createAeroplane(t,n,e){return`{\n            "type":"transform",\n            "name": "aeroplane-transform",\n            "transform": [\n                {"rotate": [90,1,0,0]},\n                {"scale": [${t},${n},${e}]},\n                {"translate":[0,0,0]}\n            ],\n            "child": {\n                "type": "object",\n                "name": "aeroplanenode",\n                "instanceof": "aeroplane",\n                "material": {\n                    "ambient": [${Math.random()},${Math.random()},${Math.random()}, ${Math.random()}],\n                    "diffuse": [\n                      0.8,\n                      0.8,\n                      0.8,\n                      1.0\n                    ],\n                    "specular": [\n                      0.8,\n                      0.8,\n                      0.8,\n                      1.0\n                    ],\n                    "emission": [\n                      0.0,\n                      0.0,\n                      0.0,\n                      1.0\n                    ],\n                    "shininess": 25.0,\n                    "absorption": 1.0,\n                    "reflection": 0.0,\n                    "transparency": 0.0,\n                    "refractive_index": 0.0\n                }\n            }\n        }`}createBox(t,n,e,r,i,a){return`{\n            "type":"transform",\n            "name": "box-transform",\n            "transform": [\n                {"translate": [${r+t/2},${i+n/2},${a+e/2}]},\n                {"scale": [${t},${n},${e}]}\n            ],\n            "child": {\n                "type": "object",\n                "name": "boxnode",\n                "instanceof": "box",\n                "texture": "white",\n                "material": {\n                  "ambient": [${Math.random()},${Math.random()},${Math.random()}, ${Math.random()}],\n                  "diffuse": [\n                    0.8,\n                    0.8,\n                    0.8,\n                    1.0\n                  ],\n                  "specular": [\n                    0.8,\n                    0.8,\n                    0.8,\n                    1.0\n                  ],\n                  "emission": [\n                    0.0,\n                    0.0,\n                    0.0,\n                    1.0\n                  ],\n                  "shininess": 25.0,\n                  "absorption": 1.0,\n                  "reflection": 0.0,\n                  "transparency": 0.0,\n                  "refractive_index": 0.0\n                }\n            }\n        }`}createCone(t,n,e,r,i,a,o){return`{\n            "type":"transform",\n            "name": "cone-transform",\n            "transform": [\n                {"translate": [${r+t},${i},${a+e}]},\n                {"scale": [${t},${n},${e}]}\n            ],\n            "child": {\n                "type": "object",\n                "name": "conenode",\n                "instanceof": "cone",\n                "texture": "${o}",\n                "material": {\n                    "ambient": [1,1,1,1],\n                    "diffuse": [\n                      0.8,\n                      0.8,\n                      0.8,\n                      1.0\n                    ],\n                    "specular": [\n                      0.8,\n                      0.8,\n                      0.8,\n                      1.0\n                    ],\n                    "emission": [\n                      0.0,\n                      0.0,\n                      0.0,\n                      1.0\n                    ],\n                    "shininess": 25.0,\n                    "absorption": 1.0,\n                    "reflection": 0.0,\n                    "transparency": 0.0,\n                    "refractive_index": 0.0\n                }\n            }\n        }`}createCylinder(t,n,e,r,i,a,o){return""==o?`{\n        "type":"transform",\n        "name": "cylinder-transform",\n        "transform": [\n            {"translate": [${r+t},${i},${a+e}]},\n            {"scale": [${t},${n},${e}]}\n        ],\n        "child": {\n            "type": "object",\n            "name": "cylindernode",\n            "instanceof": "cylinder",\n            "texture": "white",\n            "material": {\n                "ambient": [${Math.random()},${Math.random()},${Math.random()}, ${Math.random()}],\n                "diffuse": [\n                  0.8,\n                  0.8,\n                  0.8,\n                  1.0\n                ],\n                "specular": [\n                  0.8,\n                  0.8,\n                  0.8,\n                  1.0\n                ],\n                "emission": [\n                  0.0,\n                  0.0,\n                  0.0,\n                  1.0\n                ],\n                "shininess": 25.0,\n                "absorption": 1.0,\n                "reflection": 0.0,\n                "transparency": 0.0,\n                "refractive_index": 0.0\n            }\n        }\n    }`:`{\n            "type":"transform",\n            "name": "cylinder-transform",\n            "transform": [\n                {"translate": [${r+t},${i},${a+e}]},\n                {"scale": [${t},${n},${e}]}\n            ],\n            "child": {\n                "type": "object",\n                "name": "cylindernode",\n                "instanceof": "cylinder",\n                "texture" : "${o}",\n                "material": {\n                    "ambient": [1,1,1,1],\n                "diffuse": [\n                  0.8,\n                  0.8,\n                  0.8,\n                  1.0\n                ],\n                "specular": [\n                  0.8,\n                  0.8,\n                  0.8,\n                  1.0\n                ],\n                "emission": [\n                  0.0,\n                  0.0,\n                  0.0,\n                  1.0\n                ],\n                "shininess": 25.0,\n                "absorption": 1.0,\n                "reflection": 0.0,\n                "transparency": 0.0,\n                "refractive_index": 0.0\n                }\n            }\n        }`}createTurrets(t,n,e,r,i,a,o,s,u,c,h,f,l,d){let m="";return d&&(m=l),`{\n            "type":"transform",\n            "name": "box-transform",\n            "transform": [\n                {"translate": [${c},${h},${f}]}\n            ],\n            "child": {\n                "type": "group",\n                "children" : [\n                    ${this.createBox(t,n,e,0,0,0)},\n                    ${this.createCylinder(r,i,a,0,n,0,m)},\n                    ${this.createCone(o,s,u,0,n+i,0,"checkerboard")}    \n                ]\n            }\n        }`}jsonHogwarts(){return`\n        {\n            "scaleinstances":"false",\n            "instances": [\n                {\n                    "name":"box",\n                    "path":"models/box.obj"\n                },\n                {\n                    "name":"cylinder",\n                    "path":"models/cylinder.obj"\n                },\n                {\n                    "name":"cone",\n                    "path":"models/cone.obj"\n                },\n                {\n                    "name":"aeroplane",\n                    "path":"models/aeroplane.obj"\n                }\n            ],\n            "images": [\n              {\n                "name": "surface",\n                "path": "textures/checkerboard.png"\n              },\n              {\n                "name": "metal",\n                "path": "textures/checkerboard.png"\n              },\n              {\n                "name" : "wall",\n                "path" : "textures/brick1.png"\n              },\n              {\n                "name" : "brick2",\n                "path" : "textures/brick2.png"\n              },\n              {\n                "name" : "earth",\n                "path" : "textures/earthmap.png"\n              },\n              {\n                "name" : "checkerboard",\n                "path" : "textures/checkerboard.png"\n              },\n              {\n                "name" : "white",\n                "path" : "textures/checkerboard.png"\n              }\n            ],\n            "root": {\n                "type": "group",\n                "name": "root",\n                "lights": [\n                  {\n                    "ambient": [\n                      0.5,\n                      0.5,\n                      0.5\n                    ],\n                    "diffuse": [\n                      0.8,\n                      0.8,\n                      0.8\n                    ],\n                    "specular": [\n                      0.8,\n                      0.8,\n                      0.8\n                    ],\n                    "position": [\n                      0.0,\n                      100.0,\n                      0.0,\n                      1.0\n                    ],\n                    "spotdirection": [\n                      0.0,\n                      -1.0,\n                      0.0,\n                      0.0\n                    ],\n                    "spotcutoff": 90.0\n                  }\n                ],\n                "children": [${this.createBox(50,20,-10,25,0,-45)}, ${this.createBox(20,20,-10,85,0,-45)}, ${this.createBox(20,20,-10,121,0,-45)}, ${this.createBox(15,20,-35,5,0,-10)}, ${this.createBox(20,20,-35,20,0,-10)}, ${this.createBox(15,20,-20,40,0,-25)}, \n                    ${this.createBox(10,20,-35,55,0,-10)}, ${this.createBox(10,20,-15,65,0,-20)}, ${this.createBox(10,20,-35,75,0,-10)}, ${this.createBox(36,20,-10,85,0,-22)}, ${this.createBox(10,20,-15,131,0,-22)}, ${this.createBox(5,20,-10,10,0,0)}, ${this.createBox(15,20,-10,25,0,0)},\n                    ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,0,0,0,"",!1)}, ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,15,0,0,"",!1)}, ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,75,0,0,"",!1)}, ${this.createTurrets(15,50,-15,7.5,10,-7.5,7.5,10,-7.5,40,0,-10,"",!1)}, ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,65,0,-10,"",!1)}, ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,121,0,-20,"",!1)}, \n                    ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,65,0,-35,"",!1)}, ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,131,0,-37,"",!1)}, ${this.createTurrets(10,50,-10,5,5,-5,5,10,-5,75,0,-45,"brick2",!1)}, ${this.createTurrets(0,0,0,12.5,40,-12.5,12.5,50,-12.5,100.5,0,-37.5,"wall",!0)}, ${this.createTurrets(25,20,-25,0,0,0,0,0,0,0,0,-45,"wall",!0)}, ${this.createTurrets(0,0,0,11,25,-11,0,0,0,1.5,20,-46.5,"wall",!0)}, ${this.createTurrets(0,0,0,10,40,-10,10,20,-10,2.5,45,-47.5,"wall",!0)}, ${this.createTurrets(0,0,0,4,30,-4,4,10,-4,0,30,-53,"wall",!0)},\n                    ${this.createTurrets(0,0,0,4,30,-4,4,10,-4,17,30,-53,"wall",!0)}, ${this.createTurrets(0,0,0,4,30,-4,4,10,-4,8.5,30,-45,"wall",!0)}, ${this.createTurrets(0,0,0,4,30,-4,4,10,-4,8.5,30,-62,"wall",!0)}, ${this.createAeroplane(1,1,1)}]\n            }\n        }\n        `}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r;void 0===(r=function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Stack=class{constructor(){this.list=[]}push(t){this.list.push(t)}pop(){if(0==this.list.length)throw new Error("Stack is empty: nothing to pop");return this.list.pop()}peek(){if(0==this.list.length)throw new Error("Stack is empty: nothing to peek");return this.list[this.list.length-1]}isEmpty(){return 0==this.list.length}}}.apply(n,[e,n]))||(t.exports=r)},function(t,n,e){var r,i;r=[e,n,e(0)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r{constructor(){this.position=e.vec4.fromValues(0,0,0,1),this.texcoord=e.vec4.fromValues(0,0,0,1)}hasData(t){switch(t){case"position":case"normal":case"texcoord":return!0;default:return!1}}getData(t){let n;switch(t){case"position":n=[this.position[0],this.position[1],this.position[2],this.position[3]];break;case"normal":n=[this.normal[0],this.normal[1],this.normal[2],this.normal[3]];break;case"texcoord":n=[this.texcoord[0],this.texcoord[1]];break;default:throw new Error("No attribute: "+t+" found!")}return n}setData(t,n){switch(t){case"position":this.position=e.vec4.fromValues(0,0,0,1);for(let t=0;t<n.length;t++)this.position[t]=n[t];break;case"normal":this.normal=e.vec4.fromValues(0,0,0,0);for(let t=0;t<n.length;t++)this.normal[t]=n[t];break;case"texcoord":this.texcoord=e.vec4.fromValues(0,0,0,1);for(let t=0;t<n.length;t++)this.texcoord[t]=n[t];break;default:throw new Error("Attribute: "+t+" unsupported!")}}getAllAttributes(){return["position","color","texcoord"]}}n.VertexPNT=r;n.VertexPNTProducer=class{produce(){return new r}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r;void 0===(r=function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ShaderLocationsVault=class{constructor(t,n){this.attribs=new Map,this.uniforms=new Map,this.getAllShaderVariables(t,n)}getAllShaderVariables(t,n){let e=t.getProgramParameter(n,t.ACTIVE_UNIFORMS);for(let r=0;r<e;r++){let e=t.getActiveUniform(n,r),i=t.getUniformLocation(n,e.name);this.addUniformLocation(e.name,i)}let r=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES);for(let e=0;e<r;e++){let r=t.getActiveAttrib(n,e),i=t.getAttribLocation(n,r.name);this.addAttribLocation(r.name,i)}}addAttribLocation(t,n){this.attribs.set(t,n)}addUniformLocation(t,n){this.uniforms.set(t,n)}getAttribLocation(t){return this.attribs.has(t)?this.attribs.get(t):-1}getUniformLocation(t){return this.uniforms.has(t)?this.uniforms.get(t):-1}}}.apply(n,[e,n]))||(t.exports=r)},function(t,n,e){var r,i;r=[e,n,e(11),e(0),e(12)],void 0===(i=function(t,n,e,r,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ScenegraphRenderer=class{constructor(t,n,e){this.gl=t,this.shaderLocations=n,this.shaderVarsToVertexAttribs=e,this.meshRenderers=new Map,this.textures=new Map}addMesh(t,n){if(t in this.meshRenderers)return;if(n.getVertexCount()<=0)return;let r=n.getVertexAttributes()[0];for(let[t,n]of this.shaderVarsToVertexAttribs)if(!r.hasData(n))throw new Error("Mesh does not have vertex attribute "+n);let i=new e.RenderableMesh(this.gl,name);i.initMeshForRendering(this.shaderVarsToVertexAttribs,n),this.meshRenderers.set(t,i)}addTexture(t,n){let e;n.substring(n.indexOf(".")+1);e=new i.TextureObject(this.gl,t,n),this.textures.set(t,e)}draw(t,n){let e=t.getLights(n);this.sendLightsToShader(e),t.draw(this,n)}sendLightsToShader(t){for(let n=0;n<t.length;n++){let e="light["+n+"].ambient",i="light["+n+"].diffuse",a="light["+n+"].specular",o="light["+n+"].position",s="light["+n+"].spotDirection",u="light["+n+"].spotCutoff";this.gl.uniform3fv(this.shaderLocations.getUniformLocation(e),t[n].getAmbient()),this.gl.uniform3fv(this.shaderLocations.getUniformLocation(i),t[n].getDiffuse()),this.gl.uniform3fv(this.shaderLocations.getUniformLocation(a),t[n].getSpecular()),this.gl.uniform4fv(this.shaderLocations.getUniformLocation(o),t[n].getPosition()),this.gl.uniform4fv(this.shaderLocations.getUniformLocation(s),t[n].getSpotDirection()),this.gl.uniform1f(this.shaderLocations.getUniformLocation(u),Math.cos(r.glMatrix.toRadian(t[n].getSpotCutoff())))}}dispose(){for(let t of this.meshRenderers.values())t.cleanup()}drawMesh(t,n,e,i){if(this.meshRenderers.has(t)){let e=this.shaderLocations.getUniformLocation("material.ambient");this.gl.uniform3fv(e,n.getAmbient()),e=this.shaderLocations.getUniformLocation("material.diffuse"),this.gl.uniform3fv(e,n.getDiffuse()),e=this.shaderLocations.getUniformLocation("material.specular"),this.gl.uniform3fv(e,n.getSpecular()),e=this.shaderLocations.getUniformLocation("material.shininess"),this.gl.uniform1f(e,n.getShininess()),e=this.shaderLocations.getUniformLocation("modelview"),this.gl.uniformMatrix4fv(e,!1,i);let a=r.mat4.create();r.mat4.invert(a,i),r.mat4.transpose(a,a),e=this.shaderLocations.getUniformLocation("normalmatrix"),this.gl.uniformMatrix4fv(e,!1,a),this.meshRenderers.get(t).draw(this.shaderLocations)}}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(3)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.RenderableMesh=class{constructor(t,n){this.gl=t,this.vbo=t.createBuffer(),this.ibo=t.createBuffer(),this.numIndices=0,this.name=n,this.offsets=new Map,this.shaderVarsToAttribs=new Map,this.vertexDataLengths=new Map}initMeshForRendering(t,n){let r;switch(this.shaderVarsToAttribs=t,n.getFaceType()){case e.Mesh.FaceType.Triangle:this.faceType=this.gl.TRIANGLES;break;case e.Mesh.FaceType.TriangleFan:this.faceType=this.gl.TRIANGLE_FAN;break;case e.Mesh.FaceType.TriangleStrip:this.faceType=this.gl.TRIANGLE_STRIP;break;case e.Mesh.FaceType.Lines:this.faceType=this.gl.LINES;break;case e.Mesh.FaceType.LineStrip:this.faceType=this.gl.LINE_STRIP;break;case e.Mesh.FaceType.LineLoop:this.faceType=this.gl.LINE_LOOP}this.vbo=this.gl.createBuffer(),this.ibo=this.gl.createBuffer();let i=n.getVertexAttributes(),a=n.getIndices(),o=new Uint16Array(a);this.numIndices=o.length;let s=0;for(let[t,n]of this.shaderVarsToAttribs){this.offsets.set(n,s);let t=i[0].getData(n).length;s+=t,this.vertexDataLengths.set(n,t)}this.shaderVarsToAttribs.size>1?this.stride=s:this.stride=0;let u=[];i.forEach(t=>{for(let[n,e]of this.shaderVarsToAttribs){let n=t.getData(e);for(r=0;r<n.length;r++)u.push(n[r])}}),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(u),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ibo),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,o,this.gl.STATIC_DRAW)}cleanup(){this.gl.deleteBuffer(this.vbo),this.gl.deleteBuffer(this.ibo)}draw(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ibo);for(let[n,e]of this.shaderVarsToAttribs){let r=t.getAttribLocation(n);r>=0&&(this.gl.vertexAttribPointer(r,this.vertexDataLengths.get(e),this.gl.FLOAT,!1,4*this.stride,4*this.offsets.get(e)),this.gl.enableVertexAttribArray(r))}this.gl.drawElements(this.faceType,this.numIndices,this.gl.UNSIGNED_SHORT,0)}setName(t){this.name=t}getName(){return this.name}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(0)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.TextureObject=class{constructor(t,n,e){this.name=n,this.id=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.id);const r=t.RGBA,i=t.RGBA,a=t.UNSIGNED_BYTE,o=new Uint8Array([0,0,255,255]);t.texImage2D(t.TEXTURE_2D,0,r,1,1,0,i,a,o);const s=new Image;s.src=e,s.addEventListener("load",()=>{t.bindTexture(t.TEXTURE_2D,this.id),t.texImage2D(t.TEXTURE_2D,0,r,i,a,s),t.generateMipmap(t.TEXTURE_2D);let n=document.createElement("canvas"),e=n.getContext("2d");n.width=s.width,n.height=s.height,e.drawImage(s,0,0),this.data=e.getImageData(0,0,s.width,s.height).data,this.width=n.width,this.height=n.height})}getTextureID(){return this.id}getName(){return this.name}getColor(t,n){let r,i,a,o;t-=Math.trunc(t),n-=Math.trunc(n),r=Math.trunc(t*this.width),i=Math.trunc(n*this.height),r=(r+this.width)%this.width,o=(i=(i+this.height)%this.height)+1,(a=r+1)>=this.width&&(a=this.width-1),o>=this.height&&(o=this.height-1);let s,u,c,h=this.lookup(r,i),f=this.lookup(a,i),l=this.lookup(r,o),d=this.lookup(a,o);return s=e.vec4.lerp(e.vec4.create(),h,l,n-Math.trunc(n)),u=e.vec4.lerp(e.vec4.create(),f,d,n-Math.trunc(n)),c=e.vec4.lerp(e.vec4.create(),s,u,t-Math.trunc(t))}lookup(t,n){return e.vec4.fromValues(this.data[4*(n*this.width+t)],this.data[4*(n*this.width+t)+1],this.data[4*(n*this.width+t)+2],this.data[4*(n*this.width+t)+3])}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(14),e(16),e(17),e(18),e(0),e(19),e(20),e(4)],void 0===(i=function(t,n,e,r,i,a,o,s,u,c){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){function n(t,n){let e=null;if(!("type"in n))throw new Error("No type of node!");switch("name"in n&&console.log("Processing: "+n.name),n.type){case"transform":e=h(t,n);break;case"group":e=m(t,n);break;case"object":e=p(t,n);break;default:throw new Error("Unknown node type")}return e}function h(t,e){let r,i="t",s=o.mat4.create();if("name"in e&&(i=e.name),r=new a.TransformNode(t,i),!("child"in e))throw new Error("No child for a transform node");if(!("transform"in e))throw new Error("No transform property for a transform node");for(let t of Object(e.transform))if("translate"in t){let n=d(t.translate);if(3!=n.length)throw new Error("3 values needed for translate");let e=o.vec3.fromValues(n[0],n[1],n[2]);o.mat4.translate(s,s,e)}else if("scale"in t){let n=d(t.scale);if(3!=n.length)throw new Error("3 values needed for scale");let e=o.vec3.fromValues(n[0],n[1],n[2]);o.mat4.scale(s,s,e)}else if("rotate"in t){let n=d(t.rotate);if(4!=n.length)throw new Error("4 values needed for rotate");let e=n[0],r=o.vec3.fromValues(n[1],n[2],n[3]);o.mat4.rotate(s,s,o.glMatrix.toRadian(e),r)}if(r.addChild(n(t,e.child)),r.setTransform(s),"lights"in e)for(let t of Object(e.lights)){let n=f(t);r.addLight(n)}return r}function f(t){let n=new c.Light;if("ambient"in t){let e=d(t.ambient);if(3!=e.length)throw new Error("3 values needed for ambient");n.setAmbient(e)}if("diffuse"in t){let e=d(t.diffuse);if(3!=e.length)throw new Error("3 values needed for diffuse");n.setDiffuse(e)}if("specular"in t){let e=d(t.specular);if(3!=e.length)throw new Error("3 values needed for specular");n.setSpecular(e)}if("position"in t){let e=d(t.position);if(4!=e.length)throw new Error("4 values needed for position");0!=e[3]?n.setPosition(e):n.setDirection(e)}if("direction"in t){let e=d(t.direction);if(3!=e.length)throw new Error("3 values needed for direction");n.setDirection(e)}if("spotdirection"in t){let e=d(t.spotdirection);if(4!=e.length)throw new Error("4 values needed for spot direction");n.setSpotDirection(e)}if("spotcutoff"in t){let e=parseFloat(t.spotcutoff);n.setSpotAngle(e)}return n}function l(t){let n=new u.Material;if("ambient"in t){let e=d(t.ambient);if(console.log(e),4!=e.length)throw new Error("4 values needed for ambient");n.setAmbient(e)}if("diffuse"in t){let e=d(t.diffuse);if(4!=e.length)throw new Error("4 values needed for diffuse");n.setDiffuse(e)}if("specular"in t){let e=d(t.specular);if(4!=e.length)throw new Error("4 values needed for specular");n.setSpecular(e)}if("emissive"in t){let e=d(t.emissive);if(4!=e.length)throw new Error("4 values needed for emissive");n.setEmission(e)}if("shininess"in t){let e=parseFloat(t.shininess);n.setShininess(e)}if("absorption"in t){let e=parseFloat(t.absorption);n.setAbsorption(e)}if("reflection"in t){let e=parseFloat(t.reflection);n.setReflection(e)}if("transparency"in t){let e=parseFloat(t.transparency);n.setTransparency(e)}if("refractive_index"in t){let e=parseFloat(t.refractive_index);n.setRefractiveIndex(e)}return n}function d(t){let n=[];for(let e in t)n.push(parseFloat(t[e]));return n}function m(t,e){let i,a="g";"name"in e&&(a=e.name),i=new r.GroupNode(t,a);for(let r of e.children){let e=n(t,r);i.addChild(e)}if("lights"in e)for(let t of Object(e.lights)){let n=f(t);i.addLight(n)}return i}function p(t,n){let e,r="g";"name"in n&&(r=n.name);let i=new u.Material;if(e=new s.LeafNode(n.instanceof,t,r),"material"in n&&(i=l(n.material)),e.setMaterial(i),"texture"in n){let t=n.texture;e.setTextureName(t)}else e.setTextureName("white");if("lights"in n)for(let t of Object(n.lights)){let n=f(t);e.addLight(n)}return e}function v(t,n,e,r){return new Promise(a=>{let o=new Map;for(let t of Object.keys(n)){let e=n[t].path;o.set(n[t].name,e)}i.ObjImporter.batchDownloadMesh(o,r,e).then(n=>{for(let[e,r]of n)t.addPolygonMesh(e,r);a(t)})})}function g(t,n){for(let e of Object.keys(n)){n[e].path;t.addTexture(n[e].name,n[e].path)}return t}t.importJSON=function(t,r){return new Promise((i,a)=>{let o,s=JSON.parse(r),u=new e.Scenegraph,c=!0;if(!("instances"in s))throw new Error("No meshes in the scene graph!");"scaleinstances"in s&&"false"==s.scaleinstances&&(c=!1),v(u,s.instances,c,t).then(t=>{if(!("root"in s))throw new Error("No root in the scene graph!");"images"in s&&(t=g(t,s.images)),o=n(t,s.root),t.makeScenegraph(o),i(t)})})},t.handleNode=n,t.handleTransformNode=h,t.handleLight=f,t.handleMaterial=l,t.convertToArray=d,t.handleGroupNode=m,t.handleLeafNode=p,t.handleInstances=v,t.handleTextures=g}(n.ScenegraphJSONImporter||(n.ScenegraphJSONImporter={}))}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(15)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Scenegraph=class{constructor(){this.root=null,this.meshes=new Map,this.nodes=new Map,this.textures=new Map}dispose(){this.renderer.dispose()}getNumLights(){return this.root.getNumLights()}setRenderer(t){this.renderer=t;for(let[t,n]of this.meshes)this.renderer.addMesh(t,n);for(let[t,n]of this.textures)this.renderer.addTexture(t,n)}makeScenegraph(t){this.root=t,this.root.setScenegraph(this)}draw(t){null!=this.root&&null!=this.renderer&&this.renderer.draw(this.root,t)}closest_intersection(t,n){let r=new e.HitRecord(1/0);return null!=this.root&&null!=this.renderer&&this.root.calculateHitInfo(t,n,r),r}addPolygonMesh(t,n){this.meshes.set(t,n)}animate(t){}addNode(t,n){this.nodes.set(t,n)}getRoot(){return this.root}getPolygonMeshes(){return this.meshes}getNodes(){return this.nodes}addTexture(t,n){this.textures.set(t,n)}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r;void 0===(r=function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.HitRecord=class{constructor(t){this.t=t}setTime(t){this.t=t}setIntersectionPoint(t){this.intersectionPoint=t}setNormal(t){this.intersectionPoint=t}setMaterials(t){this.materials=t}getTime(){return this.t}}}.apply(n,[e,n]))||(t.exports=r)},function(t,n,e){var r,i;r=[e,n,e(1)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r extends e.SGNode{constructor(t,n){super(t,n),this.children=[]}getNode(t){let n=super.getNode(t);if(null!=n)return n;let e=0,r=null;for(;e<this.children.length&&null==r;)r=this.children[e].getNode(t),e++;return r}setScenegraph(t){super.setScenegraph(t),this.children.forEach(n=>n.setScenegraph(t))}draw(t,n){this.children.forEach(e=>e.draw(t,n))}calculateHitInfo(t,n,e){this.children.forEach(r=>r.calculateHitInfo(t,n,e))}clone(){let t=[];this.children.forEach(n=>t.push(n.clone()));let n=new r(this.scenegraph,name);return this.children.forEach(t=>n.addChild(t)),n}addChild(t){this.children.push(t),t.setParent(this)}getChildren(){return this.children}getNumLights(){let t=super.getNumLights();return this.children.forEach(n=>{t+=n.getNumLights()}),t}getLights(t){let n=super.getLights(t);return this.children.forEach(e=>{e.getLights(t).forEach(t=>n.push(t))}),n}}n.GroupNode=r}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(3),e(0)],void 0===(i=function(t,n,e,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){function n(t,n,i){class a{constructor(t,n,e){this.vertexIndex=t,this.textureIndex=n,this.normalIndex=e}hash(){return this.vertexIndex+","+this.textureIndex+","+this.normalIndex}}let o,s,u,c,h,f,l,d,m,p=new Map;s=[],u=[],c=[],l=[],f=[],h=[];let v=n.split(/\r?\n/);m=0,v.forEach(t=>{if(t=t.trim(),m++,t.length>0&&!t.startsWith("#")){let n=t.split(/\s+/);switch(n[0]){case"v":{if(n.length<4||n.length>7)throw new Error("Line "+m+": Vertex coordinate has an invalid number of values");let t=r.vec4.create();if(t[0]=parseFloat(n[1]),t[1]=parseFloat(n[2]),t[2]=parseFloat(n[3]),t[3]=1,5==n.length){let e=parseFloat(n[4]);0!=e&&(t[0]/=e,t[1]/=e,t[2]/=e)}s.push(t)}break;case"vn":{if(4!=n.length)throw new Error("Line "+m+": Normal has an invalid number of values");let t=r.vec3.create();t[0]=parseFloat(n[1]),t[1]=parseFloat(n[2]),t[2]=parseFloat(n[3]),r.vec3.normalize(t,t),u.push(r.vec4.fromValues(t[0],t[1],t[2],0))}break;case"vt":{if(n.length<3||n.length>4)throw new Error("Line "+m+": Texture coordinate has an invalid number of values");let t=r.vec4.create();t[0]=parseFloat(n[1]),t[1]=parseFloat(n[2]),t[2]=0,t[3]=1,n.length>3&&(t[2]=parseFloat(n[3])),c.push(t)}break;case"f":if(n.length<4)throw new Error("Line "+m+": Face has too few vertices, must be at least 3");for(n.shift(),n=function(t){let n=[];if(t.length<=3)n=t;else for(let e=1;e<t.length-1;e++)n.push(t[0]),n.push(t[e]),n.push(t[e+1]);return n}(n),d=0;d<n.length;d++){let t=n[d].split("/");if(t.length<1&&t.length>3)throw new Error("Line "+m+": Face specification has an incorrect number of values");let e=parseInt(t[0])-1,r=-1,i=-1;t.length>1&&(t[1].length>0&&(r=parseInt(t[1])-1),t.length>2&&(i=parseInt(t[2])-1)),h.push(new a(e,r,i))}}}});let g=!1,M=!1;if(u.length>0&&(g=!0),c.length>0&&(M=!0),h.forEach(n=>{let e=n.hash(),r=-1;if(e in p)r=p.get(e);else{let i=t.produce();i.setData("position",[s[n.vertexIndex][0],s[n.vertexIndex][1],s[n.vertexIndex][2]]),g&&i.setData("normal",[u[n.normalIndex][0],u[n.normalIndex][1],u[n.normalIndex][2]]),M&&i.setData("texcoord",[c[n.textureIndex][0],c[n.textureIndex][1],c[n.textureIndex][2]]),f.push(i),p.set(e,f.length-1),r=f.length-1}l.push(r)}),(o=new e.Mesh.PolygonMesh).setVertexData(f),o.setPrimitives(l,e.Mesh.FaceType.Triangle),i){o=new e.Mesh.CanonicalMesh(o).getMesh()}return o}t.downloadMesh=function(t,e,r=!0){return new Promise(i=>{let a,o;a=fetch(t).then(t=>t.text()).then(t=>o=n(e,t,r)),Promise.resolve(a).then(t=>{i(t)})})},t.batchDownloadMesh=function(t,e,r=!0){return new Promise(i=>{let a=[],o=new Map;for(let[i,o]of t)a.push(fetch(o).then(t=>t.text()).then(t=>{let a=n(e,t,r);return[i,a]}));Promise.all(a).then(t=>{for(let[n,e]of t)o.set(n,e);i(o)})})},t.importMesh=n}(n.ObjImporter||(n.ObjImporter={}))}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(1),e(0)],void 0===(i=function(t,n,e,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends e.SGNode{constructor(t,n){super(t,n),this.transform=r.mat4.create(),this.animationTransform=r.mat4.create(),this.child=null}getLights(t){t.push(r.mat4.clone(t.peek())),r.mat4.multiply(t.peek(),t.peek(),this.animationTransform),r.mat4.multiply(t.peek(),t.peek(),this.transform);let n=super.getLights(t);if(null!=this.child){this.child.getLights(t).forEach(t=>n.push(t))}return t.pop(),n}getNumLights(){return super.getNumLights()+this.child.getNumLights()}clone(){let t;t=null!=this.child?this.child.clone():null;let n=new i(this.scenegraph,this.name);if(n.setTransform(this.transform),n.setAnimationTransform(this.animationTransform),null!=t)try{n.addChild(t)}catch(t){}return n}getNode(t){let n=super.getNode(t);return null!=n?n:null!=this.child?this.child.getNode(t):null}addChild(t){if(null!=this.child)throw new Error("Transform node already has a child");this.child=t,this.child.setParent(this)}draw(t,n){n.push(r.mat4.clone(n.peek())),r.mat4.multiply(n.peek(),n.peek(),this.animationTransform),r.mat4.multiply(n.peek(),n.peek(),this.transform),null!=this.child&&this.child.draw(t,n),n.pop()}calculateHitInfo(t,n,e){n.push(r.mat4.clone(n.peek())),r.mat4.multiply(n.peek(),n.peek(),this.animationTransform),r.mat4.multiply(n.peek(),n.peek(),this.transform),null!=this.child&&this.child.calculateHitInfo(t,n,e),n.pop()}setAnimationTransform(t){this.animationTransform=t}getTransform(){return this.transform}setTransform(t){this.transform=r.mat4.clone(t)}getAnimationTransform(){return this.animationTransform}setScenegraph(t){super.setScenegraph(t),null!=this.child&&this.child.setScenegraph(t)}}n.TransformNode=i}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(1),e(0)],void 0===(i=function(t,n,e,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i extends e.SGNode{constructor(t,n,e){super(n,e),this.meshName=t}setMaterial(t){this.material=t}setTextureName(t){this.textureName=t}getMaterial(){return this.material}clone(){let t=new i(this.meshName,this.scenegraph,this.name);return t.setMaterial(this.getMaterial()),t}draw(t,n){this.meshName.length>0&&t.drawMesh(this.meshName,this.material,this.textureName,n.peek())}calculateHitInfo(t,n,e){this.meshName.length>0&&("sphere"==this.meshName&&this.calculateHitInfoSphere(t,n,e),"box"==this.meshName&&this.calculateHitInfoBox(t,n,e))}calculateHitInfoSphere(t,n,e){let i=n.peek(),a=r.vec4.fromValues(t.getStartPoint()[0],t.getStartPoint()[1],t.getStartPoint()[2],1),o=r.vec4.fromValues(t.getDirection()[0],t.getDirection()[1],t.getDirection()[2],1),s=r.vec3.create();r.mat4.getTranslation(s,i),r.vec4.transformMat4(a,a,i);let u=r.vec3.create();r.mat4.getScaling(u,i);let c=o,h=a,f=c[0],l=c[1],d=c[2],m=h[0],p=h[1],v=h[2],g=u[0],M=Math.pow(f,2)+Math.pow(l,2)+Math.pow(d,2),b=2*(f*(m-g)+l*(p-g)+d*(v-g)),x=Math.pow(m,2)+Math.pow(p,2)+Math.pow(v,2)-Math.pow(g,2),w=1/0,y=(-b+Math.sqrt(Math.pow(b,2)-4*M*x))/(2*M),T=(-b-Math.sqrt(Math.pow(b,2)-4*M*x))/(2*M);if(y>=0&&(w=y),T>=0&&T<y&&(w=T),w<e.getTime()){e.setTime(w);let t=r.vec4.create(),n=r.vec4.create();r.vec4.scale(n,o,w),r.vec4.add(t,a,n),e.setIntersectionPoint(t)}}calculateHitInfoBox(t,n,e){let i=n.peek(),a=r.vec4.fromValues(t.getStartPoint()[0],t.getStartPoint()[1],t.getStartPoint()[2],1),o=r.vec4.fromValues(t.getDirection()[0],t.getDirection()[1],t.getDirection()[2],1),s=r.vec3.create();r.mat4.getTranslation(s,i),r.vec4.transformMat4(a,a,i),console.log(o[0],o[1],o[2],o[3]);let u=r.vec3.create();r.mat4.getScaling(u,i);let c=o,h=a,f=c[0],l=c[1],d=c[2],m=h[0],p=h[1],v=h[2],g=1/0,M=1/0,b=1/0,x=1/0,w=1/0,y=1/0,T=[g=(-.5-m)/f,M=(.5-m)/f,b=(-.5-p)/l,x=(.5-p)/l,w=(-.5-v)/d,y=(.5-v)/d],S=1/0;for(let t=0;t<6;t++)T[t]>0?T[t]<S&&(S=T[t]):T[t]=1/0;if(S<e.getTime()){e.setTime(S);let t=r.vec4.create(),n=r.vec4.create();r.vec4.scale(n,o,S),r.vec4.add(t,a,n),e.setIntersectionPoint(t)}}}n.LeafNode=i}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(0)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Material=class{constructor(){this.emission=e.vec3.create(),this.ambient=e.vec3.create(),this.diffuse=e.vec3.create(),this.specular=e.vec3.create(),this.init()}Material(t){this.emission=new e.vec3(t.getEmission()),this.ambient=new e.vec3(t.getAmbient()),this.diffuse=new e.vec3(t.getDiffuse()),this.specular=new e.vec3(t.getSpecular()),this.setShininess(t.getShininess()),this.setAbsorption(t.getAbsorption()),this.setReflection(t.getReflection()),this.setTransparency(t.getTransparency()),this.setRefractiveIndex(t.getRefractiveIndex())}init(){this.setEmission([0,0,0]),this.setAmbient([0,0,0]),this.setDiffuse([0,0,0]),this.setSpecular([0,0,0]),this.setShininess(0),this.setAbsorption(1),this.setReflection(0),this.setTransparency(0)}setEmission(t){this.emission=e.vec3.fromValues(t[0],t[1],t[2])}setAmbient(t){this.ambient=e.vec3.fromValues(t[0],t[1],t[2])}setDiffuse(t){this.diffuse=e.vec3.fromValues(t[0],t[1],t[2])}setSpecular(t){this.specular=e.vec3.fromValues(t[0],t[1],t[2])}setShininess(t){this.shininess=t}setAbsorption(t){this.absorption=t}setReflection(t){this.reflection=t}setTransparency(t){this.transparency=t,this.ambient[3]=this.diffuse[3]=this.specular[3]=this.emission[3]=1-t}setRefractiveIndex(t){this.refractive_index=t}getEmission(){return e.vec3.fromValues(this.emission[0],this.emission[1],this.emission[2])}getAmbient(){return e.vec3.fromValues(this.ambient[0],this.ambient[1],this.ambient[2])}getDiffuse(){return e.vec3.fromValues(this.diffuse[0],this.diffuse[1],this.diffuse[2])}getSpecular(){return e.vec3.fromValues(this.specular[0],this.specular[1],this.specular[2])}getShininess(){return this.shininess}getAbsorption(){return this.absorption}getReflection(){return this.reflection}getTransparency(){return this.transparency}getRefractiveIndex(){return this.refractive_index}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r,i;r=[e,n,e(0)],void 0===(i=function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Ray=class{constructor(t,n){this.startPoint=e.vec3.create(),this.direction=e.vec3.create(),this.startPoint=t,this.direction=n}getStartPoint(){return this.startPoint}getDirection(){return this.direction}}}.apply(n,r))||(t.exports=i)},function(t,n,e){var r;void 0===(r=function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Controller=class{constructor(t){this.view=t,this.view.setFeatures(this)}go(){this.view.initScenegraph().then(()=>{let t=this.view.getNumLights();this.view.initShaders(this.getPhongVShader(),this.getPhongFShader(t)),this.view.initRenderer(),this.view.draw()})}getPhongVShader(){return"\n        attribute vec4 vPosition;\n        attribute vec4 vNormal;\n        \n        uniform mat4 projection;\n        uniform mat4 modelview;\n        uniform mat4 normalmatrix;\n        varying vec3 fNormal;\n        varying vec4 fPosition;\n        \n        void main()\n        {\n            vec3 lightVec,viewVec,reflectVec;\n            vec3 normalView;\n            vec3 ambient,diffuse,specular;\n        \n            fPosition = modelview * vPosition;\n            gl_Position = projection * fPosition;\n        \n        \n            vec4 tNormal = normalmatrix * vNormal;\n            fNormal = normalize(tNormal.xyz);\n        }\n        \n    "}getPhongFShader(t){return"precision mediump float;\n\n        struct MaterialProperties\n        {\n            vec3 ambient;\n            vec3 diffuse;\n            vec3 specular;\n            float shininess;\n        };\n        \n        struct LightProperties\n        {\n            vec3 ambient;\n            vec3 diffuse;\n            vec3 specular;\n            vec4 position;\n            vec4 spotDirection;\n            float spotCutoff;\n        };\n        \n        \n        varying vec3 fNormal;\n        varying vec4 fPosition;\n\n        \n        \n        \n        uniform MaterialProperties material;\n        uniform LightProperties light["+t+"];\n        \n        \n        void main()\n        {\n            vec3 lightVec,viewVec,reflectVec;\n            vec3 normalView;\n            vec3 ambient,diffuse,specular;\n            float nDotL,rDotV;\n            vec4 result;\n        \n        \n            result = vec4(0,0,0,1);\n        for (int i=0;i<"+t+";i++)\n            {\n                if (light[i].position.w!=0.0)\n                    lightVec = normalize(light[i].position.xyz - fPosition.xyz);\n                else\n                    lightVec = normalize(-light[i].position.xyz);\n        \n                vec3 tNormal = fNormal;\n                normalView = normalize(tNormal.xyz);\n                nDotL = dot(normalView,lightVec);\n        \n                viewVec = -fPosition.xyz;\n                viewVec = normalize(viewVec);\n        \n                reflectVec = reflect(-lightVec,normalView);\n                reflectVec = normalize(reflectVec);\n        \n                rDotV = max(dot(reflectVec,viewVec),0.0);\n        \n                vec3 spotDirection = normalize(light[i].spotDirection.xyz);\n                \n                if (dot(spotDirection,-lightVec)>light[i].spotCutoff) {\n                    ambient = material.ambient * light[i].ambient;\n                    diffuse = material.diffuse * light[i].diffuse * max(nDotL,0.0);\n                    if (nDotL>0.0)\n                        specular = material.specular * light[i].specular * pow(rDotV,material.shininess);\n                    else\n                        specular = vec3(0,0,0);\n                    result = result + vec4(ambient+diffuse+specular,1.0);  \n                }  \n            }\n            gl_FragColor = result;\n        }\n        \n    "}}}.apply(n,[e,n]))||(t.exports=r)},function(t,n,e){var r;void 0===(r=function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.RTView=class{constructor(){if(this.canvas=document.querySelector("#raytraceCanvas"),!this.canvas)return void console.log("Failed to retrieve the <canvas> element");document.querySelector("#savebutton").addEventListener("click",t=>this.saveCanvas())}saveCanvas(){let t=document.createElement("a");t.href=this.canvas.toDataURL("image/png"),t.download="result.png",t.click()}fillCanvas(t,n,e){Number(this.canvas.getAttribute("width")),Number(this.canvas.getAttribute("height"));let r=this.canvas.getContext("2d").createImageData(n,e);for(let i=0;i<e;i++)for(let e=0;e<n;e++)r.data[4*(i*n+e)]=255*t[i*n+e][0],r.data[4*(i*n+e)+1]=255*t[i*n+e][1],r.data[4*(i*n+e)+2]=255*t[i*n+e][2],r.data[4*(i*n+e)+3]=255;this.canvas.getContext("2d").putImageData(r,0,0)}}}.apply(n,[e,n]))||(t.exports=r)}]);
//# sourceMappingURL=ScenegraphsLightsTextures.js.map